2007-05-19  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/controllers/application.rb (ApplicationController::don_is_spam): Add 'Akismet' timeout error handling.

2007-05-10  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/test/integration/cache_test.rb (CacheTest::test_caching_fix_article): New test.

	* donrails/app/models/article_sweeper.rb (ArticleSweeper): Fix to use for clear cache function.
	
	* donrails/lib/akismet.rb (Akismet::call_akismet): When Akismet host down or name resolution error, all messages are not blocked.

2007-05-09  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/controllers/admin/article_controller.rb (Admin): Fix to run cache_sweeper when use preview_article_confirm.

	* donrails/lib/akismet.rb (Akismet::call_akismet): Add timeout (5 seconds)

	* donrails/test/integration/login_story_test.rb (LoginStoryTest::test_login): Cleanup.

	* donrails/config/routes.rb: Add for parameter interpretaion miss for fcgi?

2007-05-06  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/test/functional/admin/login_controller_test.rb (Admin::test_logout)
	(Admin::test_authenticate__fail, Admin::test_authenticate)
	(Admin::test_login_index): move from login_controller_test.

	* donrails/test/functional/admin/comment_controller_test.rb (Admin::test_delete_comment)
	(Admin::test_manage_comment): move from login_controller_test.

	* donrails/test/functional/admin/trackback_controller_test.rb (Admin::test_delete_trackback)
	(Admin::test_manage_trackback): move from login_controller_test.

	* donrails/test/functional/admin/picture_controller_test.rb (Admin::test_picture_save)
	(Admin::test_delete_picture_2, Admin::test_delete_picture_1)
	(Admin::test_delete_picture, Admin::test_edit_picture_4)
	(Admin::test_edit_picture_3, Admin::test_edit_picture_2)
	(Admin::test_edit_picture_1, Admin::test_edit_picture)
	(Admin::test_manage_picture_detail_1)
	(Admin::test_manage_picture_detail)
	(Admin::test_manage_picture_1, Admin::test_manage_picture): move from login_controller_test.

	* donrails/test/functional/admin/category_controller_test.rb (Admin::test_delete_category_1)
	(Admin::test_delete_category, Admin::test_add_category_1)
	(Admin::test_add_category, Admin::test_manage_category_1)
	(Admin::test_manage_category): move from login_controller_test.

	* donrails/test/functional/admin/article_controller_test.rb (Admin::test_form_article)
	(Admin::test_fix_article, Admin::test_fix_article__1)
	(Admin::test_add_article, Admin::test_manage_article)
	(Admin::test_delete_article)
	(Admin::test_delete_article__issue33, Admin::test_new_article)
	(Admin::test_new_article_1): move from login_controller_test.

	* donrails/test/functional/admin/enrollment_controller_test.rb (Admin::test_manage_enrollment)
	(Admin::test_delete_enrollment): move from login_controller_test.

	* donrails/test/functional/admin/banlist_controller_test.rb (Admin::test_test_banlist)
	(Admin::test_test_banlist, Admin::test_add_banlist_ipaddr)
	(Admin::test_add_banlist, Admin::test_delete_banlist)
	(Admin::test_manage_banlist): move from login_controller_test.

	* donrails/app/controllers/admin/comment_controller.rb (Admin)
	(Admin::manage_comment, Admin::delete_hidden_comment_all)
	(Admin::delete_comment): move from 'login controller'.

	* donrails/admin/shared/*: move from donrails/login/shared.
	* donrails/app/views/admin/article/manage_article.rhtml: Fix to apply it.
	* donrails/app/views/admin/article/form_article.rhtml: Fix to apply it.
	* donrails/app/views/admin/article/new_article.rhtml: Fix to apply it.
	* donrails/app/views/admin/category/manage_category.rhtml: Fix to apply it.
	* donrails/app/views/admin/trackback/manage_trackback.rhtml: Fix to apply it.
	* donrails/app/views/admin/system/manage_author.rhtml: Fix to apply it.
	* donrails/app/views/admin/system/manage_don_rbl.rhtml: Fix to apply it.
	* donrails/app/views/admin/system/manage_don_env.rhtml: Fix to apply it.

	* donrails/app/controllers/admin/system_controller.rb (Admin::bm)
	(Admin::manage_don_env, Admin::add_don_env)
	(Admin::delete_don_env, Admin::manage_don_rbl)
	(Admin::add_don_rbl, Admin::delete_don_rbl): move from 'login controller'.

	* donrails/app/controllers/admin/trackback_controller.rb (Admin)
	(Admin::manage_trackback, Admin::table_trackback_a)
	(Admin::akismet_report, Admin::delete_trackback)
	(Admin::delete_hidden_trackback_all): move from 'login controller'.

	* donrails/app/views/admin/banlist/manage_banlist.rhtml: move from under views/login.

	* donrails/app/controllers/admin/banlist_controller.rb (Admin::manage_banlist)
	(Admin::delete_banlist, Admin::add_banlist)
	(Admin::banlist_test_by_ar_ipaddr)
	(Admin::banlist_test_by_ar_hostname)
	(Admin::banlist_test_by_ar_regexp)
	(Admin::banlist_test_by_ar_string, Admin::banlist_test_by_ar)
	(Admin::test_banlist, Admin::banlist_test_by_valid): move from 'login controller'.

	* donrails/app/views/admin/enrollment/*.rhtml: move from under views/login.	

	* donrails/app/controllers/admin/enrollment_controller.rb (Admin)
	(Admin::manage_enrollment, Admin::delete_enrollment): move from 'login controller'.

	* donrails/app/views/admin/picture/*.rhtml: move from under views/login.

	* donrails/app/controllers/admin/picture_controller.rb (Admin)
	(Admin::manage_picture, Admin::manage_picture_detail)
	(Admin::edit_picture, Admin::delete_picture)
	(Admin::picture_save): move from 'login controller'.

	* donrails/app/views/admin/attachment/*.rhtml: move from under views/login.

	* donrails/app/controllers/admin/attachment_controller.rb (Admin::manage_don_attachment)
	(Admin::manage_don_attachment_detail)
	(Admin::edit_don_attachment, Admin::don_attachment_save): move from 'login controller'.

	* donrails/app/views/admin/category/manage_category.rhtml: move from under views/login.

	* donrails/app/controllers/admin/category_controller.rb (Admin::manage_category)
	(Admin::add_category, Admin::delete_category): move from 'login controller'.

	* donrails/app/views/admin/login/index.rhtml: move from under views/login.

	* donrails/app/controllers/admin/login_controller.rb 
	(Admin::login_index)
	(Admin::authenticate, Admin::logout): move from 'login controller'.

	* donrails/app/views/admin/article/*.rhtml: move from under views/login.

	* donrails/app/controllers/admin/article_controller.rb (Admin::new_article)
	(Admin::form_article, Admin::preview_article_confirm)
	(Admin::fix_article, Admin::add_article, Admin::manage_article)
	(Admin::delete_article): move from 'login controller'.

	* donrails/app/controllers/admin/hnf_controller.rb 
	(Admin::hnf_save_all)
	(Admin::hnf_save_date, Admin::hnf_save_date_inner_all)
	(Admin::hnf_save_date_inner): move from 'login controller'.

	* donrails/app/controllers/admin/system_controller.rb (Admin::delete_cache): FIX: move from 'login controller'.

2007-05-04  ARAKI Yasuhiro  <yasu@debian.or.jp>

	** New controller
	* donrails/app/controllers/admin/system_controller.rb (Admin)
	(Admin::manage_don_ping, Admin::manage_blogping)
	(Admin::delete_blogping, Admin::add_blogping)
	(Admin::manage_author, Admin::delete_unwrite_author)
	(Admin::add_author): move from login_controller.rb.
	* donrails/app/views/admin/system/manage_{author,cache,don_ping,blogping}.rhtml: move under app/views/login.
	* donrails/app/views/layouts/login.rhtml: Change to apply these.

2007-05-01  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/controllers/application.rb (ApplicationController::authorize): Move from LoginController.

2007-04-24  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/controllers/login_controller.rb (LoginController::fix_article): Small fix.

2007-04-21  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/views/login/preview_article.rhtml: Add "reedit" function.

2007-04-20  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/views/login/form_article.rhtml: Add <hr>.

	* donrails/app/views/login/shared/table_{article,comment}.rhtml: added magic character for recognize utf-8.

	* donrails/app/views/login/form_article.rhtml: modify in tagoh's fix in r215.
	
2007-04-20  Akira TAGOH  <at@gclab.org>

	* donrails/app/views/login/form_article.rhtml: Fix to select the
	format recently used at new_article.

2007-04-15  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/views/login/shared/table_article.rhtml: New file. It spins off from 'login/manage_article'.
	* donrails/app/views/login/manage_article.rhtml: Change to use it.

	* donrails/app/views/login/form_article.rhtml: Small fix to use default article format.

	* donrails/config/routes.rb: Order change to use '/archives/show_category'.

	* donrails/app/views/login/shared/table_trackback.rhtml: move file.
	* donrails/app/views/login/manage_trackback.rhtml: Change to use it.

	* donrails/app/views/login/shared/edit_don_rbl.rhtml: move file.
	* donrails/app/views/login/manage_don_rbl.rhtml: Change to use it.
	
	* donrails/app/views/login/manage_comment.rhtml: Change to use it.
	* donrails/app/views/login/shared/table_comment.rhtml: move file.

	* donrails/app/views/login/shared/edit_don_env.rhtml: move file.
	* donrails/app/views/login/manage_don_env.rhtml: Change to use it.

	* donrails/app/views/login/shared/edit_category.rhtml: move file.
	* donrails/app/views/login/manage_category.rhtml: Change to use it.
	
	* donrails/app/views/login/shared/add_banlist.rhtml: move file.
	* donrails/app/views/login/manage_comment.rhtml: Change to use it.
	* donrails/app/views/login/manage_trackback.rhtml: Change to use it.
	* donrails/app/views/login/manage_banlist.rhtml: Change to use it.

	* donrails/app/views/login/shared/edit_author.rhtml: move file.
	* donrails/app/views/login/manage_author.rhtml: Chage to use it.

	* donrails/app/views/login/shared/upload_picture.rhtml: New file.
	* donrails/app/views/login/new_article.rhtml: Change to use it.

2007-04-14  ARAKI Yasuhiro  <yasu@debian.or.jp>
	
	* donrails/app/views/login/new_article.rhtml: Change to include 'login/form_article' view.
	* donrails/app/views/login/form_article.rhtml: Change to apply it.

	* Change to delete article when you submit 'delete' button at 'login/preview_article'.
	* donrails/app/controllers/login_controller.rb 
	(LoginController::preview_article_confirm): likewise.
	(LoginController::fix_article): Change to use article.hidden = 2 for preview.
	* donrails/app/views/login/preview_article.rhtml: likewise.

2007-04-12  Akira TAGOH  <at@gclab.org>

	* donrails/app/models/don_attachment.rb (filesave_internal):
	s/Digest::MD5.new/Digest::MD5.new.update/

	* donrails/tool/tables-postgresql.sql (don_attachments): remove
	'comment' column that isn't necessary aymore.

2007-04-09  ARAKI Yasuhiro  <yasu@debian.or.jp>

	**¡¡New feature: added article preview function.
	* donrails/app/controllers/login_controller.rb (LoginController::fix_article): Apply for preview_article.
	* donrails/public/stylesheets/login.css: add some format.
	* donrails/app/views/login/new_article.rhtml: likewise.
	* donrails/app/views/login/form_article.rhtml: likewise.

	* donrails/app/views/layouts/login.rhtml: Fix mail address and author name in <header/>.

2007-04-05  ARAKI Yasuhiro  <yasu@debian.or.jp>

	** RELEASE as donrails-1.6.0
	* Please see at http://code.google.com/p/donrails/wiki/Donrails_1_6.
	
	* donrails/app/controllers/rdf_controller.rb (RdfController::rdf_category): Fix @params to params.

2007-04-02  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/controllers/notes_controller.rb (NotesController): fix add_comment2. Maybe it was caused by updating rails1.2? Now add_comment2 does not use verify_form_posts_have_security_token.

	* donrails/app/helpers/application_helper.rb (ApplicationHelper::display_categories_roots_ul): Fix to link under '/archives/show_category'. (Is it a bug of link_to in rails1.2.3?)

2007-04-01  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/config/routes.rb: Small fix.

2007-03-25  ARAKI Yasuhiro  <yasu@debian.or.jp>

	*** APPLY FOR rails1.2 ***
	* Many files are changed to apply rails1.2.
	* donrails/app/models/category.rb (Category): Add name validator. You can not add numeral only category name.

2007-03-20  Akira TAGOH  <at@gclab.org>

	* donrails/app/views/shared/MT/module-titlelist.rhtml:
	  Fix a javascript to get it working properly.

	* donrails/app/models/article.rb (send_pings2): rescue all exceptions.

2007-03-17  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/views/rdf/rss2_category.rxml: Change time entity from 'dc:date' to 'pubDate'.

	* donrails/app/views/rdf/*.rxml: Fix wrong link.

	* donrails/app/views/notes/show_category.rhtml: Change link address. Because when 'category name' is not ascii letters, link_to make a missing link.
	* donrails/app/views/notes/default/noteslist.rhtml: likewise.
	* donrails/test/integration/cache_test.rb: Change to apply for it.
	* donrails/app/models/article_sweeper.rb: likewise.
	* donrails/app/controllers/rdf_controller.rb: likewise.
	* donrails/app/controllers/notes_controller.rb: likewise.
	* donrails/config/routes.rb: likewise.

2007-03-15  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/tool/tables-mysql.sql: Fix. (BLOB and TEXT columns cannot have DEFAULT values.)
	* donrails/tool/tables-postgresql.sql: likewise.

	* donrails/test/unit/don_attachment_test.rb: New. (TODO: test for some methods )
	
	* patch from akira yamada (at Mar. 10 and 13)
	
2007-03-11  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/models/don_attachment.rb 
	(DonAttachment::filesave_internal): Change: no use Dir.pwd.
	(DonAttachment::filedump_name): Change to use inputted filename.

	* donrails/app/views/shared/edit_don_env.rhtml: Add small message.

	* donrails/tool/tables-{mysql,postgresql}.sql: Set default value in DonEnv.image_dump_path.

	* donrails/test/fixtures/don_envs.yml: Change in image_dump_path.

	* donrails/app/controllers/login_controller.rb: Fix: removed duplicate methods.
	
	* donrails/app/views/layouts/login.rhtml: Add link to manage_don_attachment.
	
	* donrails/app/models/don_attachment.rb (DonAttachment::filesave_internal): Change to use extname of original filename for older than rails 2.0. (See also: http://api.rubyonrails.org/classes/ActionView/Helpers/AssetTagHelper.html#M000595)

	* patch from akira yamada for administration of don_attachment.
	- donrails/app/models/don_attachment.rb
	- donrails/app/models/picture.rb
	- donrails/app/controllers/notes_controller.rb
	- donrails/app/controllers/login_controller.rb
	- donrails/app/views/shared/attachments/picture.rhtml
	- donrails/app/views/login/manage_don_attachment.rhtml
	- donrails/app/views/login/manage_picture_detail.rhtml
	- donrails/app/views/login/manage_don_attachment_detail.rhtml
	- donrails/app/views/login/manage_picture.rhtml
	
	* donrails/app/views/layouts/login.rhtml: Add donrails bookmarklet.
	* donrails/app/views/login/new_article.rhtml: Change to apply for bookmarklet.
	* donrails/app/controllers/login_controller.rb (LoginController::bm): New method which catches input from bookmarklet. And some redirection fix.

2007-03-10  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/tool/donrails-setup.rb: add line change.(Report by akira yamada)

2007-03-09  akira yamada  <akira@arika.org>

	* donrails/tool/td2db.rb (TDiary::Dummy): remove duplicated methods.

2007-02-20  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/views/shared/table_trackback.rhtml: Change: You can report to akismet via Ajax link.
	* donrails/app/controllers/login_controller.rb 
	(LoginController::akismet_report): Add to apply it.
	(LoginController::table_trackback_a): Add to apply it.

	* donrails/app/views/layouts/default/notes.rhtml: add "effects" and "controls" javascript link.

	* README.cache.ja: Add information to test caching.
	* donrails/app/views/login/manage_{category,trackback}.rhtml: Small fix

	* donrails/example/database-mysqltest.yml: New file
	* Makefile: Add "make mysqltest" (*TODO*)
	
2007-02-18  Akira TAGOH  <at@gclab.org>

	* Makefile: Make a symlink for test dir to be rake-test-ready.

	* donrails/tool/tables-postgresql.sql: set default value to
	notify_level.

	* donrails/tool/tables-mysql.sql: add notify_level to don_envs.

	* upgrade_1_6.mysql.sql, upgrade_1_6.postgresql.sql:
	correct default value for notify_level.

2007-02-18  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/test/functional/login_controller_test.rb (LoginControllerTest::test_edit_picture_{2,3,4}): New test.
	* donrails/app/controllers/login_controller.rb (LoginController::edit_picture): Small fix.

2007-02-16  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/views/rdf/{rdf,rss2}_{recent,enrollment}.rxml: Fix link.

	* donrails/app/controllers/login_controller.rb 
	(LoginController::akismet_report): Change: When you SPAM report to Akismet, trackback.spam is 1. To the contrary, When you HAM report to Akismet, trackback.spam is 0.
	(LoginController::delete_trackback): Change to apply, when you check/uncheck spam checkbox in manage_trackback.
	* donrails/test/functional/login_controller_test.rb (LoginControllerTest::test_delete_trackback): Change to check.
	* donrails/test/fixtures/trackbacks.yml (second_trackback): Add to apply these changes.

2007-02-16  Akira TAGOH  <at@gclab.org>

	* upgrade_1_6.postgresql.sql: correct constraint for don_rbls.

	* donrails/tool/tables-postgresql.sql: sync.

2007-02-13  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/views/layouts/default/notes.rhtml: Add RSS format version in title.

2007-02-11  ARAKI Yasuhiro  <yasu@debian.or.jp>

	** New Add rss2 entries.
	** Split rdf related actions from notes controller to rdf controller.
	* donrails/config/routes.rb: Added rss2_* entries.
	* donrails/app/views/rdf/rss2_*.rxml: New files.
	* donrails/app/views/rdf/rdf_*.rxml: Moved from app/views/notes/rdf_*.
	* donrails/app/views/layouts/default/notes.rhtml: Apply to change. Add auto_discovery_link_tag to rss2.
	* donrails/app/views/layouts/MT/notes.rhtml: Apply to change. Add auto_discovery_link_tag to rss2.
	* donrails/app/controllers/notes_controller.rb: Apply to change.
	* donrails/app/controllers/rdf_controller.rb: New file.
	* donrails/app/models/article_sweeper.rb: Apply to change.
	* donrails/app/helpers/rdf_helper.rb: New file.
	* donrails/test/functional/notes_controller_test.rb: Apply to change.
	* donrails/test/functional/rdf_controller_test.rb: New file.

2007-01-22  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/controllers/login_controller.rb (LoginController::manage_don_attachment): New method.
	(LoginController::manage_don_attachment_detail): New method.
	(LoginController::edit_don_attachment): New method.

	* donrails/app/views/login/manage_don_attachment_detail.rhtml: New file.
	* donrails/app/views/login/manage_don_attachment.rhtml: New file.

2007-01-21  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/test/fixtures/blogpings.yml: Change entry.
	* donrails/test/functional/login_controller_test.rb (LoginControllerTest::test_delete_blogping): fix for fixture change.

	* donrails/app/models/don_attachment.rb (DonAttachment): Add 'include ApplicationHelper' to fix a problem which is caused when initial input is XML-RPC.
	* donrails/app/apis/movable_type_service.rb (MovableTypeService::setPostCategories): Ignore when wrong or no-existent category id is inputted.
	* donrails/app/models/author.rb (Author::self.authenticate): Fix.
	* donrails/test/functional/notes_controller_test.rb (NotesControllerTest::test_add_comment2): Add to unuse Akismet in this test.(Added @request.env['skip_akismet'] = true)
	(NotesControllerTest::test_add_comment2__too_short): Split this test from test_add_comment2.

2007-01-20  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/apis/don_web_service.rb (DonWebService): Add 'include ApplicationHelper' to fix a problem which is caused when initial input is XML-RPC.

2007-01-19  Akira TAGOH  <at@gclab.org>

	* upgrade_1_6.postgresql.sql: add.

2007-01-18  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/models/don_ping.rb (DonPing::send_ping2): Revised this change. It cause to lost connection between DB. Sorry.
	
	* donrails/app/models/don_ping.rb (DonPing::send_ping2): Change to wrap in Thread in order to apply for too slow Blog Ping Aggregator (like pingoo).

2007-01-17  ARAKI Yasuhiro  <yasu@debian.or.jp>

	** donrails-1.5.99.3
	* donrails/app/controllers/login_controller.rb: Change to apply don_attachments_articles.
	* donrails/app/views/login/manage_picture_detail.rhtml: likewise.

2007-01-08  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* test/functional/login_controller_test.rb: Character code change to UTF-8.


	** donrails-1.5.99.2
	* NEW Feature at 1.6: Change to add 'has and belongs to' relation for don_attachments and articles (Enhance issue #35) NEW tables: don_attachments_articles.
	* UNCOMPATIBLE table change. Please apply upgrade_1_6.mysql.sql before use.
	* test/integration/login_story_test.rb: Apply for don_attachments_articles.
	* test/fixtures/don_attachments.yml: likewise.
	* app/helpers/application_helper.rb: Change for robustness.
	* app/models/article_sweeper.rb: Apply for don_attachments_articles.
	* app/models/article.rb: likewise.
	* app/models/don_attachment.rb: likewise.
	* app/models/don_ping.rb: Cleanup.
	* app/controllers/login_controller.rb: Cleanup.
	* app/views/login/manage_picture_detail.rhtml: Apply for don_attachments_articles. But I will add some codes to apply for don_attachments_articles.
	* app/views/login/manage_picture.rhtml: Apply for don_attachments_articles.
	* tool/tables-postgresql.sql: Apply for don_attachments_articles.
	* tool/tables-mysql.sql: Apply for don_attachments_articles.
	
2007-01-04  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/models/picture.rb (Picture::picture): Fix picture.name to picture.title.

2007-01-03  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/views/layouts/simple.rhtml: New file.
	* rails/app/helpers/application_helper.rb (ApplicationHelper::display_article_attachments): New method.
	* donrails/test/unit/don_attachment_test.rb (DonAttachmentTest): New test. (Remove donrails/test/unit/picture_test.rb.)
	* donrails/test/functional/notes_controller_test.rb: Small fix for test.
	* donrails/test/integration/*_test.rb: Change to apply don_attachments TABLE.
	* donrails/test/fixtures/pictures.yml: Remove.
	* donrails/test/fixtures/don_attachments.yml: New file.
	* donrails/app/models/article_sweeper.rb: Change to clean article at record.enrollment_id - 1.
	* donrails/app/models/{article,picture}.rb: Change to apply don_attachments TABLE.
	* donrails/app/models/don_attachment.rb: Change to apply don_attachments TABLE.
	* donrails/app/models/don_ping.rb: Small fix for qeury character.
	* donrails/app/controllers/application.rb: Small fix.
	* donrails/app/controllers/login_controller.rb: Add 'picture_save' in cache_sweeper entry. And Change to apply don_attachments TABLE.
	* donrails/app/controllers/notes_controller.rb: Change to apply don_attachments TABLE.
	(NotesController): Add to use layout/simple.rhtml.

	* donrails/app/views/shared/table_trackback.rhtml: likewise.
	* donrails/app/views/shared/attachments/picture.rhtml: New file.
	* donrails/app/views/login/manage_picture_detail.rhtml: Change to apply don_attachments TABLE.
	* donrails/app/views/login/manage_picture.rhtml: likewise.
	* donrails/app/views/notes/MT/show_enrollment.rhtml: likewise.
	* donrails/app/views/notes/default/show_title.rhtml: likewise.
	* donrails/app/views/notes/default/noteslist.rhtml: likewise.

	** donrails-1.5.99.1
	* NEW Feature at 1.6: You can expand attachment of article. (issue #35)
	* UNCOMPATIBLE table change. Please apply upgrade_1_6.mysql.sql before use.
	
2006-12-22  ARAKI Ysauhiro  <yasu@debian.or.jp>

	* Release: donrails-1.5.1.
	* Remove tables-sqlite.sql. After donrails 1.5, sqlite/sqlite3 are not supported!.
	* fix issues #36,37.

2006-12-17  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/controllers/application.rb (ApplicationController::don_is_spam): If @request.env['skip_akismet'] is true, then donrails does not use Akismet.


2006-12-14  Akira TAGOH  <at@gclab.org>

	* upgrade_1_X.postgresql.sql: correct charset setting.

	* donrails/lib/modules/moinmoin.rb: support the automatic link
	feature.

2006-12-11  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/controllers/login_controller.rb (LoginController::authenticate): Fix for ActionController::DoubleRenderError.(issue #36)


2006-11-26  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/controllers/application.rb (ApplicationController::don_is_spam): New feature: Whitelist.

	* donrails/lib/antispam.rb (AntiSpam::scan_ipaddr_white): Change this method from protected to public.
	(AntiSpam::scan_ipaddr): Change not to use scan_ipaddr_white.

2006-11-23  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/controllers/login_controller.rb (LoginController::delete_hidden_comment_all): New method to delete all of comments that hidden are 1.
	* donrails/app/views/shared/table_comment.rhtml:  Add link to delte_hidden_comment_all
	* donrails/app/views/shared/table_trackback.rhtml: Add link to delte_hidden_trackback_all
	* donrails/app/controllers/login_controller.rb (LoginController::delete_hidden_trackback_all): New method to delete all of trackbacks that hidden are 1.

	* donrails/app/controllers/application.rb (ApplicationController::don_is_spam?): Add method to integrate antispam method.	
	* donrails/app/models/trackback.rb (Trackback): likewise. Remove some entories to apply it.
	* donrails/lib/antispam.rb (AntiSpam::is_spam_by_antispam): likewise. New method.
	* donrails/app/controllers/notes_controller.rb (NotesController::add_comment2): likewise. Change to apply it.
	* donrails/test/functional/notes_controller_test.rb (NotesControllerTest::test_add_comment2__spam): Add test for it.

	** New feature: You can set nofify e-mail level in DonEnv.notify_level when comment/trackback received. If set is
	- 0: no e-mail
	- 1: mail for non spam message.
	- 2: mail for all message.
	* donrails/app/models/comment_mailer.rb (CommentMailer::notify): likewise.
	* donrails/app/controllers/notes_controller.rb (NotesController::trackback): likewise.
	* donrails/app/controllers/login_controller.rb (LoginController::add_don_env): likewise.
	* donrails/app/views/shared/edit_don_env.rhtml: likewise.
	* donrails/app/views/login/manage_don_env.rhtml: likewise.
	* donrails/test/fixtures/don_envs.yml (first): likewise.
	* upgrade_1_5.mysql.sql: likewise.
	* upgrade_1_5.postgresql.sql: likewise.

2006-11-20  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/controllers/notes_controller.rb (NotesController::trackback): Change to return 403 when receive wrong trackback.
	* donrails/test/functional/notes_controller_test.rb (NotesControllerTest::test_trackback__too_old): Change to apply it.
	(NotesControllerTest::test_trackback__akismet): likewise.
	(NotesControllerTest::test_trackback__2): likewise.

	* donrails/lib/akismet.rb: Fix for rake test stability.

2006-11-19  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/controllers/login_controller.rb (LoginController::akismet_report): Add new mthod to spam/ham report to Akismet.
	* donrails/app/views/shared/add_banlist.rhtml: likewise. Some format change.
	* donrails/app/views/shared/table_trackback.rhtml: likewise. Add report method to Akismet.

	** NOTE ** Incompatible change. 
	* New feature: Change to use Akismet. (http://akismet.com/).
	* donrails/app/controllers/notes_controller.rb (NotesController::trackback): Add to use Akismet.
	* donrails/tool/tables-postgresql.sql: likewise.
	* donrails/tool/tables-mysql.sql: likewise. 
	* donrails/lib/akismet.rb: likewise. New file.
	* donrails/app/views/login/manage_don_env.rhtml: likewise. Add entry.
	* donrails/app/views/shared/edit_don_env.rhtml (akismet_key): likewise. Add entry.
	* donrails/app/controllers/login_controller.rb (LoginController::add_don_env): likewise. Add entry.
	* donrails/app/models/comment_mailer.rb (CommentMailer::notify): likewise. If trackback is bloked by akismet, display 'hidden is 1' in notify mail.
	* donrails/test/fixtures/don_envs.yml (first): Add akismet_key.
	* donrails/test/functional/notes_controller_test.rb (NotesControllerTest::test_trackback__akismet): likewise. Add test.
	* donrails/app/views/comment_mailer/notify.rhtml: likewise. If trackback is bloked by akismet, display 'hidden is 1' in notify mail.
	* donrails/tool/tables-mysql.sql: 'add column akismet_key TEXT' in don_envs table.
	* upgrade_1_5.mysql.sql: New file.
	* upgrade_1_5.postgresql.sql: New file.

2006-11-12  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/helpers/application_helper.rb (ApplicationHelper::display_article_categories): Change to use from ':category' to ':id' in link_to.

2006-11-09  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/controllers/login_controller.rb (LoginController::fix_article): Fix: When no category.

	* donrails/test/functional/login_controller_test.rb (LoginControllerTest::test_delete_article__issue33): likewise.

	* donrails/test/fixtures/articles.yml: likewise.

	* donrails/test/fixtures/enrollments.yml: Add entry to fix for issue #33

	* donrails/app/views/login/form_article.rhtml: Add to show 'space is a category separator'. (issue #34)
	* donrails/app/controllers/login_controller.rb (LoginController::fix_article): Fix to add plural new category. (issue #34)

2006-11-07  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/test/integration/browse_story_test.rb (BrowseStoryTest): Move some test to login_story_test.rb

	* donrails/test/integration/login_story_test.rb (LoginStoryTest): New test file.
	
	* donrails/app/controllers/login_controller.rb
	(LoginController::login_index): Cleanup. (Close issue #31)
	
	* r130
	* donrails/app/controllers/login_controller.rb (LoginController::authorize): Change to apply for no PATH_INFO support httpd. Change to use @request.env['PATH_INFO'] or @request.env['REQUEST_URI'].

	* r129
	* donrails/app/controllers/login_controller.rb (LoginController::fix_article): Fix to add new category. (issue #30)
	(LoginController::authenticate): Change to redirect_to flash[:op]. (issue #31? TODO: check)

	* donrails/test/functional/login_controller_test.rb (LoginControllerTest::test_add_banlist_ipaddr): Add test for private method (banlist_test_by_ar_ipaddr).

	* donrails/app/controllers/login_controller.rb (LoginController::banlist_test_by_ar_ipaddr): Small Change for stability. 

2006-11-05  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/controllers/login_controller.rb (LoginController::new_article): Change to use loing username as default article author.
	* donrails/app/views/login/new_article.rhtml: likewise.

2006-11-04  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/controllers/application.rb (ApplicationController::don_delete_all): New method. It deletes all files and sub-directories. 
	(ApplicationController::don_delete_cache_all): New method. It called by login/delete_cache.
	* donrails/app/controllers/login_controller.rb (LoginController::delete_don_env): Change to clear all cached pages.
	(LoginController::add_don_env): likewise.
	* donrails/app/controllers/login_controller.rb (LoginController::delete_cache): New method: It deletes all files and directories for cache pages.
	
	* INSTALL.ja: Change to use /login/manage_don_env
	* donrails/tool/donrails-setup.rb: Cleanup.

2006-11-03  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/models/article_sweeper.rb (ArticleSweeper::ep_atom): Fix to erase /atom/feed.xml.

	* donrails/app/views/layouts/login.rhtml: Fix link to manage_don_ping.

	* donrails/app/models/comment_mailer.rb (CommentMailer::notify): Fix url from notes to archives. (issue #28)

	* donrails/app/views/atom/post.rxml: likewise.

	* donrails/app/views/atom/categories.rxml: likewise.

	* donrails/app/views/atom/image_post.rxml: likewise.

	* donrails/app/views/atom/index.rxml: likewise.

	* donrails/app/views/atom/feed.rxml: Fix for comply rfc4287 and http://xmlns.com/wordnet/1.6/ for category.

2006-11-03  Akira TAGOH  <at@gclab.org>

	* donrails/tool/td2db.rb: deal with comments and trackbacks
	separately. (issue #20) Patch from akira yamada.

	* donrails/tool/td2db.rb (TDiary::Dummy::mobile_agent?): new method to
	not generate HTMLs for mobile. (issue #19) Patch from akira yamada.
	(TDiary::Dummy::user_agent): likewise.

	* donrails/tool/td2db.rb: fix a debugging message to not screwed up.
	(issue #18) Patch from akira yamada.

	* donrails/tool/td2db.rb: fix possible plugin errors. (issue #17)
	Patch from akira yamada.

2006-11-02  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/models/article_sweeper.rb (ArticleSweeper::ep_notes): Add logging when expire '/public/index.html'.

	* donrails/app/controllers/notes_controller.rb (NotesController::noteslist): When neithor article found nor don_env found, redirect_to manage_don_env. (issue #26)

	* donrails/example/donrails_env.rb: Remove unused setting. 

	* donrails/tool/tables-postgresql.sql: Rename Ping to DonPing. (issue #27)	
	* donrails/tool/tables-mysql.sql: likewise.

	* donrails/app/controllers/login_controller.rb (LoginController::manage_don_ping): Rename Ping to DonPing. (issue #27)	
	* upgrade_1_4.mysql.sql: likewise.
	* upgrade_1_4.postgresql.sql: likewise.
	* donrails/app/models/article.rb (Article): likewise.
	* donrails/test/unit/don_ping_test.rb (PingTest): likewise.
	* donrails/test/integration/browse_story_test.rb (BrowseStoryTest): likewise.
	* donrails/test/integration/cache_test.rb (CacheTest): likewise.
	* donrails/test/integration/browse_mt_test.rb (BrowseStoryTest): likewise.
	* donrails/test/functional/login_controller_test.rb (LoginControllerTest::test_manage_don_ping): likewise.
	* donrails/app/models/don_ping.rb (DonPing): likewise.
	* donrails/app/views/login/manage_ping.rhtml: likewise.

	* donrails/app/models/article_sweeper.rb (ArticleSweeper::ep_notes): Fix to delete '/public/index.html'.

	* donrails/app/apis/meta_weblog_service.rb (MetaWeblogService::newPost): Fix to apply checking Article.validates_presence_of enrollment_id.
	* donrails/app/apis/blogger_service.rb (BloggerService::newPost): likewise.

2006-10-31  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/helpers/application_helper.rb (ApplicationHelper::don_get_oldconfig): Fix to initial login. (issue #26)

	* Usage CHANGE. Before adding article, you have to add at least an author by using '/login/manage_author'. (issue #25)
	* donrails/app/controllers/login_controller.rb (LoginController::fix_article): fix: When author name set. 
	* donrails/app/models/article.rb (Article): Add validates_presence_of author_id, title, format and enrollment_id.
	* donrails/app/controllers/login_controller.rb (LoginController::add_article): Change to return 404. When you had not input author entry, you get 404.
	* donrails/test/unit/enrollment_test.rb 
	(EnrollmentTest::test_2): Change to apply these changes.
	(EnrollmentTest::test_1): likewise.

2006-10-30  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/views/atom/feed.rxml: fix generator url.

2006-10-29  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/controllers/login_controller.rb (LoginController::fix_article): Fix to show trackback URL from 'notes' to 'archives'.
	(LoginController::add_article): likewise.

2006-10-28  Akira TAGOH  <at@gclab.org>

	* donrails/app/views/layouts/MT/notes.rhtml: show the categorylist by
	default.

	* donrails/app/views/shared/MT/module-categorylist.rhtml:
	new file to show the category list with Ajax.

	* donrails/app/views/shared/MT/module-titlelist.rhtml:
	modified to show the recent articles with Ajax.

	* donrails/app/views/shared/MT/simple-hatena.rhtml:
	new file to add links for Hatena Bookmark features.

2006-10-27  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/config/routes.rb: Fix for such url (e.g. http://cfard3:3000/archives/category/road.html )	
	* donrails/app/controllers/notes_controller.rb (NotesController::show_category): likewise.
	* donrails/test/integration/browse_story_test.rb (BrowseStoryTest::test_fromtop): Add test for it.

	* donrails/app/models/ping.rb (Ping): Fix to change '/notes' to appropriate URI. This problem cause problem when you add/modify a article.

2006-10-26  ARAKI Yasuhiro  <yasu@debian.or.jp>

	** TABLE change. VARCHAR(100) to TEXT.
	* upgrade_1_4.mysql.sql: New file. 
	* donrails/tool/tables-mysql.sql: Apply for this change. (For
	PostgreSQL and Sqlite were not modified. TODO).

	* donrails/app/views/notes/rdf_recent.rxml: Change channel link url from '/archives' to ''.

2006-10-25  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/tool/update-custom.sh: New file. It helps you to maintain  your layout customization. For usage, please read in this file.

2006-10-24  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* Remove auto_link in following files.
	- donrails/app/views/shared/MT/trackback.rhtml
	- donrails/app/views/shared/default/comment-enrollment.rhtml
	- donrails/app/views/shared/default/comment2.rhtml
	- donrails/app/views/shared/comment.rhtml
	- donrails/app/views/shared/timelink.rhtml
	- donrails/app/views/notes/MT/show_enrollment.rhtml
	- donrails/app/views/notes/MT/show_title.rhtml
	- donrails/app/views/notes/MT/noteslist.rhtml
	- donrails/app/views/notes/default/show_enrollment.rhtml
	- donrails/app/views/notes/default/show_title.rhtml
	- donrails/app/views/notes/default/noteslist.rhtml
	- donrails/app/views/notes/pick_comment_a.rhtml
	- donrails/app/views/notes/pick_article_a2.rhtml
	- donrails/app/views/notes/comment_form.rhtml
	- donrails/app/views/notes/pick_enrollment_a.rhtml
	- donrails/app/views/notes/pick_article_a.rhtml

	* donrails/app/controllers/notes_controller.rb (NotesController): Disable cache feature for show_title.

	* donrails/config/routes.rb: remove show_title entry.

2006-10-23  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/controllers/notes_controller.rb (NotesController): Change to modify for caching 'rdf_enrollment'
	* donrails/test/integration/cache_test.rb (CacheTest::test_caching_notes): likewise for 'rdf_enrollment' testing.
	(CacheTest::test_caching_notes): Add test for rdf_{recent,article}

	* donrails/app/models/article_sweeper.rb (ArticleSweeper::expire_for): Add for 'rdf_enrollment'.

	* donrails/test/functional/atom_controller_test.rb (AtomControllerTest::test_feed): Fix test code for modifing AtomController::feed.

	* donrails/app/controllers/atom_controller.rb (AtomController::feed): Fix to wrong article to show.
	* donrails/app/views/layouts/default/notes.rhtml: Fix link. likewise.
	* donrails/app/models/article_sweeper.rb (ArticleSweeper::ep_atom): Fix it. likewise.
	* donrails/config/routes.rb: Fix url map. likewise. 
	* donrails/app/views/atom/index.rxml: Fix link. likewise. 
	* donrails/app/views/atom/feed.rxml: Fix link. likewise. 

	* donrails/app/controllers/login_controller.rb (LoginController::add_article): Fix typo.

	* donrails/config/routes.rb: Fix for show_category_noteslist entry.

	* donrails/test/integration/cache_test.rb (CacheTest::test_caching_notes): Fix test path.

2006-10-22  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/test/integration/browse_mt_test.rb (BrowseStoryTest::test_fromtop): Fix test path.

	* donrails/config/routes.rb: Change URL /archives/rdf_(.+) to /rdf/rdf_$1.
	* donrails/app/models/article_sweeper.rb (ArticleSweeper::ep_category): likewise.

2006-10-21  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/config/routes.rb: Change URL /notes/ to /archives/. 
	* donrails/app/models/article_sweeper.rb: likewise.
	
	* donrails/app/models/article_sweeper.rb 
	(ArticleSweeper::expire_for): Split following methods.
	(ArticleSweeper::ep_trigger_title_a): New method.
	(ArticleSweeper::ep_atom): New method.
	(ArticleSweeper::ep_category): New method.
	(ArticleSweeper::ep_articles_long): New method.
	(ArticleSweeper::ep_author): New method.
	(ArticleSweeper::ep_notes): New method.

	* donrails/app/models/article.rb (Article::renew_mtime): Fix: When article_date is not setted, this method set it.

	* donrails/app/views/login/manage_don_rbl.rhtml: Cleanup.

	* donrails/app/controllers/login_controller.rb (LoginController::manage_don_rbl): Cleanup.

	* donrails/app/views/shared/edit_don_rbl.rhtml (rbl_type): Change to use <select>.

	* donrails/app/controllers/notes_controller.rb (NotesController::add_comment2): Fix to show article which has not enrollment_id.

2006-10-20  Akira TAGOH  <at@gclab.org>

	* donrails/app/views/layouts/MT/notes.rhtml: reflects author and
	author's email address from DB's.

	* donrails/app/views/layouts/default/notes.rhtml: likewise.

2006-10-19  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/models/ping.rb (Ping::send_ping_xmlrpc_extended): Fix rdf url.

	* donrails/app/views/login/manage_category.rhtml: Fix description.

	* donrails/app/controllers/login_controller.rb (LoginController::add_don_env): Fix to add unuse column.
	(LoginController::add_don_rbl): Fix.

	** Incompatible Change ::
	(1) Before upgrade from r91 and before, you have to prepare 'don_envs' and 'don_rbls' TABLE. Please see 'donrails/tool/tables-{postgresql,mysql,sqlite}.sql'. 
	(2) After that, Please go '/login/manage_don_env' and './login/manage_don_rbl'. Then please input your configration like 'donrails_env.rb'.
	
	* donrails/app/helpers/application_helper.rb 
	(ApplicationHelper::don_get_oldconfig): New method (it splitted from don_get_config) for backward compatibility. 
	(ApplicationHelper::don_get_config): likewise.

	* r94
	* donrails/app/models/comment_mailer.rb (CommentMailer::notify): Change address for manage. Now show /login/manage_{comment,trackback}
	* donrails/app/helpers/application_helper.rb (ApplicationHelper::don_get_theme): Change to use don_get_config.
	* donrails/app/controllers/login_controller.rb: Call don_get_config. (return is used as @@dgc.)
	(LoginController::authenticate): Change to use @@dgc.

	* r93
	* donrails/app/controllers/login_controller.rb (LoginController::authenticate): Fix to redirect "new_article" (in some case).

	* donrails/app/views/layouts/login.rhtml: Add link to manage_don_{rbl,env}.

	* donrails/lib/antispam.rb (AntiSpam::initialize): Change to use DonEnv and DonRbl.

	* donrails/app/helpers/application_helper_test.rb: Change to test at rails directory like 'ruby app/helpers/application_helper_test.rb'.
	(TC_ApplicationHelper::test_don_get_config): new method.
	(TC_ApplicationHelper::test_don_get_ip_rbl): new method.
	(TC_ApplicationHelper::test_don_get_host_rbl): new method.

2006-10-18  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/helpers/application_helper.rb (ApplicationHelper::don_get_config): Backword compatibility. If you had not set DonEnv and had set at donrails_env.rb, return temporaly DonEnv.

	* donrails/app/models/article_sweeper.rb (ArticleSweeper::expire_for): Add to erase for 'noteslist' when Category, Comment, Trackback and Picture update.

	* donrails/app/controllers/login_controller.rb (LoginController::manage_don_rbl): New method to use DonRbl.
	(LoginController::add_don_rbl): likewise.
	(LoginController::delete_don_rbl): likewise.
	* donrails/app/views/login/manage_don_rbl.rhtml: New file.
	* donrails/app/views/shared/edit_don_rbl.rhtml: New file
	
2006-10-17  ARAKI Yasuhiro  <yasu@debian.or.jp>

	** Prepare to use DonRbl. (to be enable use in near few days.)
	* donrails/test/fixtures/don_rbls.yml:
	* donrails/test/unit/don_rbl_test.rb: likewise. New file.
	* donrails/app/models/don_rbl.rb:

	** NEW feature: Add DonEnv TABLE. It will replace donrails_env.rb in near future.
	* donrails/tool/tables-mysql.sql: Add to use DonEnv (and DonRbl).
	* donrails/tool/tables-postgresql.sql: Add to use DonEnv (and DonRbl).
	* donrails/tool/tables-sqlite.sql: Add to use DonEnv (and DonRbl).
	* donrails/app/models/don_env.rb: New file to use DonEnv.
	* donrails/app/views/shared/edit_don_env.rhtml: New file.
	* donrails/app/views/login/manage_don_env.rhtml: New file.
	* donrails/test/unit/don_env_test.rb: likewise. New file.
	* donrails/test/fixtures/don_envs.yml: likewise. New file.
	* donrails/app/helpers/application_helper.rb 
	(ApplicationHelper::don_get_config): New method to get entry of DonEnv TABLE.
	(ApplicationHelper::display_article_images): Change to use don_get_config.
	* donrails/app/controllers/login_controller.rb 
	(LoginController::authenticate): likewise.
	(LoginController::manage_blogping): likewise.
	(LoginController::manage_don_env): New method. 
	(LoginController::add_don_env): New method. 
	(LoginController::delete_don_env): New method. 
	* donrails/test/unit/article_test.rb (ArticleTest): Change to use don_get_config. Add :don_envs in fixtures in entry.
	* donrails/app/models/comment_mailer.rb (CommentMailer::notify): likewise.
	* donrails/test/unit/trackback_test.rb: likewise. Add :don_envs in fixtures in entry.
	* donrails/app/models/article.rb: likewise.
	* donrails/app/models/trackback.rb: likewise.
	* donrails/app/models/ping.rb: likewise.
	* donrails/app/models/comment.rb: likewise.
	* donrails/app/controllers/notes_controller.rb: likewise.
	* donrails/app/apis/blogger_service.rb: likewise.
	* donrails/app/views/atom/feed.rxml: likewise.
	* donrails/app/views/atom/index.rxml: likewise.
	* donrails/app/views/layouts/MT/notes.rhtml: likewise.
	* donrails/app/views/shared/MT/banner.rhtml: likewise.
	* donrails/app/views/notes/rdf_search.rxml: likewise.
	* donrails/app/views/notes/rdf_category.rxml: likewise.
	* donrails/app/views/notes/rdf_enrollment.rxml: likewise.
	* donrails/app/views/notes/rdf_recent.rxml: likewise.
	* donrails/app/views/notes/rdf_article.rxml: likewise.

	* donrails/app/controllers/login_controller.rb (LoginController::authorize): Fix to keep request path. (Change at 2006-10-14 is not valid.)
	
2006-10-16  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/controllers/atom_controller.rb (AtomController::image_post): Cleanup.

	* donrails/app/controllers/notes_controller.rb (NotesController::show_image): cleanup.

2006-10-14  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/controllers/login_controller.rb (LoginController::authorize): Change to keep request path. For example, you can access '/login/manage_enrollment' directory. If you have problems, please report me.
	(LoginController::login_index): likewise.
	(LoginController::authenticate): likewise.

	* donrails/app/views/login/index.rhtml: Add to show @flash[:notice].

2006-10-13  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/models/article_sweeper.rb (ArticleSweeper::expire_for): Add to erase 'noteslist'.
	(ArticleSweeper::expire_for): likewise.

2006-10-12  Akira TAGOH  <at@gclab.org>

	* donrails/app/views/login/form_article.rhtml: choose the format from
	things is currently available on system.

2006-10-11  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/controllers/login_controller.rb (LoginController): Fix to observe Enrollment. (Fix to erase Enrollment cache file.)
	* donrails/app/models/article_sweeper.rb (ArticleSweeper::expire_for): likewise.

	* donrails-1.3.8

	* donrails/lib/modules/html.rb (DonRails::HTML::body_to_xml): Fix to parse &nbsp;.

2006-10-09  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails-1.3.6
	
	* donrails/app/models/article_sweeper.rb (ArticleSweeper::expire_for): Fix it.

	* donrails-1.3.5
	
	* donrails/tool/tables-mysql.sql: Fix to use article_id.

	* donrails/app/apis/meta_weblog_service.rb (MetaWeblogService::newMediaObject): New method for image update.
	* donrails/app/models/picture.rb (Picture::filesave): likewise.

2006-10-08  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/models/article_sweeper.rb 
	(ArticleSweeper::expire_for): Fix to clear article when Picture/Enrollment update.

2006-10-07  Akira TAGOH  <at@gclab.org>

	IMPORTANT: incompatible changes. BASEURL doesn't include the paths
	anymore such as 'notes', which managed on RoR. it shouldn't be
	configurable by any outside RoR, because it could be misleading easily
	in some functions.

	* donrails/app/models/ping.rb (Ping::send_ping_rest): add 'notes' in
	URL.

	* donrails/app/models/ping.rb (Ping::send_ping_xmlrpc): likewise.

	* donrails/app/models/ping.rb (Ping::send_ping_xmlrpc_extended):
	likewise.

	* donrails/app/models/article.rb (Article::sendping): likewise.

	* donrails/app/models/comment_mailer.rb (CommentMailer::notify):
	likewise.

	* donrails/app/controllers/login_controller.rb (LoginController::fix_article):
	likewise.
	(LoginController::add_article): likewise.

	* donrails/example/donrails_env.rb (BASEURL): remove 'notes'

2006-10-06  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails-1.3.4

	* donrails/app/models/ping.rb (Ping::send_ping_xmlrpc_extended): New method to send 'weblogUpdates.extendedPing'.
	* donrails/app/apis/don_web_service.rb (DonWebService::ping): set 'alias :extendedPing :ping'.
	(DonWebApi): likewise.
	* donrails/test/unit/ping_test.rb (PingTest): test for it.

2006-10-06  Akira TAGOH  <at@gclab.org>

	* donrails/lib/modules/moinmoin.rb (DonRails::Moinmoin::body_to_html):
	fixed the different behavior on the definition list.

2006-10-05  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails-1.3.3

	* donrails/app/controllers/login_controller.rb (LoginController::new_article): Fix for initial setup.
	(LoginController::add_article): likewise.

	* INSTALL.ja: Refine it.

	* Makefile: Add installertest.
	* donrails/example/database-installertest.yml: New file for it.
	* donrails/example/.environment.rb: likewise.

	* donrails/tool/tables-{postgresql,sqlite}.sql: filename change (.txt -> .sql)
	

2006-10-05  Akira TAGOH  <at@gclab.org>

	* donrails/lib/modules/moinmoin.rb: MoinMoin parser.

2006-10-04  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/tool/tables-mysql.sql: Fix for donrails-1.3
	* donrails/tool/tables-sqlite.txt: Fix for donrails-1.3

2006-10-04  Akira TAGOH  <at@gclab.org>

	* donrails/lib/modules/wiliki.rb (DonRails::Wiliki::title_to_html):
	fixed regexp to deal with nested bold/italic-syntax.
	(DonRails::Wiliki::body_to_html): likewise.

2006-10-01  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/views/notes/index.rhtml: Fix to apply theme.

	* donrails/app/views/shared/default/comment.rhtml: move this file from shared/comment.rhtml.

	* donrails/app/views/notes/pick_article_a2.rhtml: Fix to use shared/comment.

	* rails/app/views/layouts/default/notes.rhtml: Fix: File path.

2006-09-30  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/test/unit/enrollment_test.rb (EnrollmentTest::test_2): Clanup.
	* donrails/test/functional/login_controller_test.rb: Add some test.
	* donrails/test/functional/notes_controller_test.rb: Change date to more futer.
	* donrails/test/fixtures/articles.yml: Add to test trackback.

	* donrails/app/models/enrollment.rb: remove unused enrollment cleanu function to article.rb.
	* donrails/app/models/article.rb: likewise.
	
	* donrails/app/controllers/login_controller.rb (LoginController::delete_enrollment): Cleanup.

	* donrails/app/models/article.rb (Article::enrollclean): New method. Add to remove unused enrollment.

	
	** NEW FEATURE: Add to send trackback function when Article create/update.
	* donrails/app/views/login/form_article.rhtml: likewise.
	* donrails/app/views/login/new_article.rhtml: likewise.
	* donrails/app/controllers/login_controller.rb 
	(LoginController::fix_article): likewise.
	(LoginController::add_article): likewise.
	* donrails/app/models/article.rb
	(Article::sendping): Fix to send enrollmented url.
	(Article::send_trackback): Fix when no article.body.

	* donrails/test/fixtures/blogpings.yml (first_blogping): Fix entry point for test.

	* donrails/test/functional/login_controller_test.rb (LoginControllerTest::test_fix_article): likewise.
	(LoginControllerTest::test_add_article): likewise.
	(LoginControllerTest::test_delete_blogping): fix entry point.

	* donrails/test/unit/enrollment_test.rb (EnrollmentTest::test_2): cleanup.

2006-09-29  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/controllers/login_controller.rb (LoginController::delete_enrollment):  Fix to stop update_attribute for unchanged enrollment.

	* donrails/app/models/enrollment.rb (Enrollment::clean_enrollment): Add new method for cleanup enrollment which has not related articles.

	* donrails/app/apis/blogger_service.rb (BloggerService::getUsersBlogs): Fix to enable retrieve RDF_TITLE.

	* donrails/app/controllers/login_controller.rb (LoginController::delete_article): Fix to stop update_attribute for unchanged article.

	* donrails/test/unit/comment_test.rb (CommentTest::test_1): Cleanup.

	* donrails/test/unit/article_test.rb (ArticleTest::test_renew_mtime): Add some test.

2006-09-29  Akira TAGOH  <at@gclab.org>

	* donrails/lib/modules/wiliki.rb (DonRails::Wiliki::title_to_html)
	(DonRails::Wiliki::body_to_html): fixed to deal with the inline syntax
	properly.

2006-09-29  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/models/enrollment.rb (Enrollment): Change to depend Article.

	* donrails/app/models/trackback.rb (Trackback): Remove 'excerpt' length validater. Because it caused side effect at banlist management. (todo)
	* donrails/test/functional/notes_controller_test.rb (NotesControllerTest::test_trackback__too_short_excerpt): likewise. Comment out.
	
	* donrails/app/controllers/notes_controller.rb 
	(NotesController::show_title): Cleanup.
	(NotesController::trackback): Cleanup.
	
2006-09-28  ARAKI Yasuhiro  <yasu@debian.or.jp>
	
	* donrails/app/models/trackback.rb (Trackback::notify_by_mail): likewise.
	* donrails/app/models/comment.rb (Comment::notify_by_mail): Fix to send comment mail.

	
	* donrails/app/models/ping.rb (Ping::send_ping2): Change to call send_ping_xmlrpc. If it fails, call send_ping_rest.
	(Ping::send_ping_rest): Rename send_ping2 to send_ping_rest. And refine it.
	(Ping::send_ping_xmlrpc): New method.

	* donrails/app/apis/don_web_service.rb (DonWebServiceStructs): likewise.
	(DonWebApi): likewise.
	(DonWebService::ping): likewise.

	* donrails/test/unit/ping_test.rb (PingTest::test_send_ping_xmlrpc): Apply for sending XML-RPC ping.

2006-09-27  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/lib/antispam.rb: Cleanup. Remove "[SP]" info in log.

	* NEW Feature: XML-RPC for blog client. (Tested by MS windows live writer.)
	* donrails/app/models/author.rb 
	(Author::self.authenticate): Add for XML-RPC.
	(Author::self.authenticate): likewise.
	* donrails/app/controllers/backend_controller.rb: likewise.
	* donrails/app/apis/don_web_service.rb: likewise.
	* donrails/app/apis/movable_type_service.rb: likewise.
	* donrails/app/apis/blogger_service.rb: likewise.
	* donrails/app/apis/meta_weblog_service.rb: likewise.
	
2006-09-26  ARAKI Yasuhiro  <yasu@debian.or.jp>
	
	* donrails/app/controllers/atom_controller.rb (AtomController::post): Fix to apply enrollment.

2006-09-26  Akira TAGOH  <at@gclab.org>

	* donrails/app/views/shared/MT/trackback.rhtml: implemented.

	* donrails/app/views/shared/MT/comment.rhtml:
	* donrails/app/views/shared/MT/simple-trackback.rhtml:
	* donrails/app/views/shared/MT/simple-comment.rhtml: add an anchor.

2006-09-25  Akira TAGOH  <at@gclab.org>

	* donrails/app/models/trackback.rb (Trackback::notify_by_mail):
	don't send email if no ADMIN_MAILADD defined.

	* donrails/app/views/notes/MT/show_enrollment.rhtml:
	* donrails/app/views/notes/MT/show_title.rhtml: updated to follow
	noteslist.rhtml.

	* donrails/app/views/shared/MT/simple-category.rhtml: updated for more
	informative design.

	* donrails/app/views/shared/MT/pagelink.rhtml: makes much better DOM
	trees for MT support.

	* donrails/app/views/layouts/MT/notes.rhtml: show the page links.

2006-09-23  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/views/shared/MT/simple-comment.rhtml: fix comment number count.

	* donrails/app/models/article.rb: Cleanup.
	* donrails/app/models/comment.rb: Cleanup.
	* donrails/test/integration/browse_mt_test.rb: New test.
	* donrails/test/integration/browse_story_test.rb: Cleanup.
	* donrails/app/views/shared/MT/comment.rhtml: Fix to show comment order.

	* donrails/app/views/shared/MT/pagelink.rhtml: Copy from default/pagelink.rhtml

	* donrails/app/views/notes/show_category.rhtml: Fix to apply theme.

	* donrails/test/functional/notes_controller_test.rb (NotesControllerTest::test_parse_nums__1): Fix for routes.rb change.
	(NotesControllerTest::test_index): Skip when DEFAULT_THEME is MT.

	* donrails/app/views/notes/show_title.rhtml: Add dummy file to prevent template error for functional test.

  	* donrails/app/views/notes/pick_article_a2.rhtml: Fix parameter to call shared/comment

	* donrails/app/views/shared/MT/title-articles2no.rhtml: Add file.

	* donrails/app/views/notes/pick_article_a2.rhtml: Fix to use render file.

2006-09-23  Akira TAGOH  <at@gclab.org>

	* donrails/app/views/shared/MT/simple-category.rhtml: new file.

	* donrails/app/views/shared/default/nextlink2.rhtml: moved into the
	dfeault folder.

	* donrails/app/views/notes/default/show_title.rhtml: reflect the
	layout name from current theme.

	* donrails/app/views/notes/pick_article_a2.rhtml: likewise.

	* donrails/example/index.rhtml: likewise.

	* donrails/example/index.rhtml: fixed a
	space-before-argument-parentheses issue.

	* donrails/app/models/trackback.rb: fixed a LocalJumpError.

2006-09-23  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/test/integration/browse_story_test.rb: Fix

	* donrails/app/views/notes/default/show_title.rhtml: moved into the default folder.

	* donrails/app/views/notes/MT/show_title.rhtml: added a MovableType style.
	* donrails/app/controllers/notes_controller.rb (NotesController::show_title): Fix for apply MT style.

2006-09-22  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/test/unit/article_test.rb (ArticleTest::test_renew_mtime): Fix to apply ruby1.8.5.

2006-09-22  Akira TAGOH  <at@gclab.org>

	* donrails/app/views/layouts/MT/notes.rhtml: use RDF_TITLE.

	* donrails/app/controllers/notes_controller.rb (NotesController):
	include ApplicationHelper into self for a workaround on webrick.

	* donrails/app/views/shared/default/pagelink.rhtml: moved into
	the default folder.

	* donrails/public/stylesheets/styles-site.css: added.

	* donrails/public/stylesheets/base-weblog.css: added.

	* donrails/app/views/notes/default/show_enrollment.rhtml: 
	* donrails/app/views/notes/default/noteslist.rhtml: moved into
	the default folder.

	* donrails/app/views/notes/MT/noteslist.rhtml: added a MovableType
	compatible layout.

	* donrails/app/views/notes/MT/show_enrollment.rhtml: likewise.

	* donrails/app/views/shared/default/title-articles2no.rhtml: 
	* donrails/app/views/shared/default/title-articles2.rhtml: 
	* donrails/app/views/shared/default/title-articles.rhtml: 
	* donrails/app/views/shared/default/show_direct.rhtml: 
	* donrails/app/views/shared/default/search.rhtml: 
	* donrails/app/views/shared/default/pagelink-j.rhtml: 
	* donrails/app/views/shared/default/nextlink3.rhtml: 
	* donrails/app/views/shared/default/linktitle.rhtml: 
	* donrails/app/views/shared/default/comment2.rhtml: 
	* donrails/app/views/shared/default/comment-enrollment.rhtml: 
	* donrails/app/views/shared/default/category_title_list.rhtml: 
	* donrails/app/views/shared/default/category_select.rhtml: 
	* donrails/app/views/shared/default/authorhead.rhtml: moved into default
	folder since those modules are supposed to work in the default theme.

	* donrails/app/views/shared/MT/trackback.rhtml: new file to show
	the whole of trackbacks in article.

	* donrails/app/views/shared/MT/simple-trackback.rhtml: new file to show
	the amount of trackbacks in article.

	* donrails/app/views/shared/MT/simple-comment.rhtml: new file to show
	the amount of comments in article.

	* donrails/app/views/shared/MT/post-footer.rhtml: new file to show
	a footer.

	* donrails/app/views/shared/MT/permlink.rhtml: new file to show
	a permanent link.

	* donrails/app/views/shared/MT/module-titlelist.rhtml:
	new file to show the recent articles at the sidebar.

	* donrails/app/views/shared/MT/module-search.rhtml:
	new file to show a search box at the sidebar.

	* donrails/app/views/shared/MT/module-donrails-links.rhtml:
	new file to show donrails links at the sidebar.

	* donrails/app/views/shared/MT/comment.rhtml: new file to show
	the whole of comments.

	* donrails/app/views/shared/MT/banner.rhtml: new file to show a banner.

	* donrails/app/views/layouts/default/notes.rhtml: added a donrails
	default layout, which was actually came from an example folder.

	* donrails/app/views/layouts/MT/notes.rhtml: added a MovableType
	compatible layout.

	* donrails/app/views/notes/recent_category_title_a.rhtml:
	reflect the layout name from current theme.

	* donrails/app/controllers/notes_controller.rb: reflect the layout name
	from current theme.
	(NotesController::show_search_noteslist): likewise.
	(NotesController::articles_long): likewise.
	(NotesController::articles_author): likewise.
	(NotesController::noteslist): likewise.
	(NotesController::show_month): likewise.
	(NotesController::show_nnen): likewise.
	(NotesController::show_date): likewise.
	(NotesController::show_enrollment): likewise.
	(NotesController::show_category_noteslist): likewise.
	(NotesController::afterday): likewise.
	(NotesController::tendays): likewise.

	* donrails/app/helpers/application_helper.rb (ApplicationHelper::don_get_theme):
	new method.

2006-09-22  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/models/trackback.rb (Trackback): If you set "TRACKBACK_ENABLE_TIME" in donrails_env.rb, old trackback ping will be rejected. Plese set TRACKBACK_ENABLE_TIME in seconds. (e.g. TRACKBACK_ENABLE_TIME = 86400 * 365 * 10). If you want to enable forever, please set 0.

2006-09-21  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/test/functional/notes_controller_test.rb (NotesControllerTest::test_trackback__too_short_excerpt): Test for it.

	* donrails/app/models/trackback.rb (Trackback): length check for 'excerpt'. (minimum = 20)

2006-09-16  Akira TAGOH  <at@gclab.org>

	* donrails/tool/donrails-setup.rb: fixed a typo.

	* donrails/app/helpers/application_helper.rb (ApplicationHelper::display_article_images):
	makes an anchor to allow people to show the full-sized image.

2006-09-15  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/models/article_sweeper.rb (ArticleSweeper::expire_for): Fix from expire_for(record.articles.first) to expire_for(record.article).

	* donrails/app/controllers/login_controller.rb (LoginController::fix_article): Fix for wrong input.
	(LoginController::delete_comment): Fix for non-existing comment.

2006-09-15  Akira TAGOH  <at@gclab.org>

	* donrails/lib/antispam.rb (AntiSpam::scan_text): fixed a typo.

	* donrails/app/models/comment.rb (Comment::notify_by_mail): don't send
	a notice mail if ADMIN_MAILADD isn't set properly.

	* donrails/tool/td2db.rb: new file to import tDiary format files into
	donrails.

2006-09-14  Akira TAGOH  <at@gclab.org>

	* donrails/tool/table-postgresql.txt: updated.

	* Makefile (linkinit): fix a copy fails.

2006-09-14  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/controllers/login_controller.rb (LoginController::fix_article): Change: When no entity has changed, does not generate new article.

2006-09-13  Akira TAGOH  <at@gclab.org>

	* upgrade_1_3.postgres.sql: an upgrade sql file for PostgreSQL.

	* donrails/tool/tables-postgresql.txt: updated.

2006-09-13  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/views/shared/linktitle.rhtml: Fix to skip non existance title.

	* donrails/app/controllers/notes_controller.rb (NotesController::recent): Refine SQL statements.

	* donrails/test/functional/notes_controller_test.rb (NotesControllerTest::test_rdf_enrollment): New test.

	* donrails/app/controllers/notes_controller.rb 
	(NotesController::rdf_article): Fix: when inputted wrong id.
	(NotesController::rdf_enrollment): likewise.

	* donrails/app/views/notes/rdf_article.rxml: Fix for display image:item entry.
	* donrails/app/views/notes/rdf_recent.rxml: likewise.
	* donrails/app/views/notes/rdf_search.rxml: likewise.
	* donrails/app/views/notes/rdf_category.rxml: likewise.
	* donrails/app/views/notes/rdf_recent.rxml: likewise.

	* donrails/app/models/article_sweeper.rb (ArticleSweeper::expire_for): Add to apply for Enrollment.
	* donrails/app/views/notes/noteslist.rhtml: likewise.
	* donrails/app/views/shared/linktitle.rhtml: likewise.
	* donrails/app/models/comment_mailer.rb (CommentMailer::notify): likewise.
	* donrails/app/views/notes/recent_trigger_title_a.rhtml: likewise.
	* donrails/app/views/shared/comment2.rhtml: likewise. Add link_to permanent url.

2006-09-10  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/controllers/notes_controller.rb (NotesController::add_comment2): Change: redirect_to show_enrollment.
	(NotesController::recent): Fix: apply for remove comments_articles.

	* donrails/app/views/notes/show_enrollment.rhtml: New file.

	* donrails/app/views/shared/comment-enrollment.rhtml: New file.

	* donrails/app/models/enrollment.rb (Enrollment::self.search): New method.
	* donrails/test/unit/enrollment_test.rb (EnrollmentTest::test_search): Test for it.

	* donrails/test/functional/notes_controller_test.rb (NotesControllerTest::test_pick_enrollment_a): Add check for enrollment.comment and enrollment.trackback.

2006-09-07  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/test/fixtures/trackbacks.yml: Add new test seeds.

2006-09-06  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/test/fixtures/comments_articles.yml: Remove file.
	* donrails/test/functional/notes_controller_test.rb (NotesControllerTest::test_pick_enrollment_a): Add new test.

	* donrails/test/unit/article_test.rb (ArticleTest): Remove fixtures :comments_articles.
	* donrails/test/integration/browse_story_test.rb (BrowseStoryTest): Remove fixtures :comments_articles.

	* donrails/test/fixtures/comments.yml: Add test seeds.

	* donrails/app/controllers/login_controller.rb (LoginController::fix_article): Change to use manage_enrollment.
	* donrails/app/views/login/form_article.rhtml: likewise
	
	* donrails/app/helpers/application_helper.rb (ApplicationHelper::display_enrollment_images): New method.

	* donrails/app/controllers/login_controller.rb 
	(LoginController::manage_enrollment): New method.
	(LoginController::delete_enrollment): New method.


	* Change Comments and Articles relation.
	* donrails/app/models/comment_mailer.rb (CommentMailer::notify): Fix for this.
	* donrails/app/controllers/notes_controller.rb (NotesController::add_comment2): likewise.
	* donrails/app/controllers/login_controller.rb (LoginController::delete_comment): likewise.

2006-09-03  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* NEW FEATURE: version control with Enrollment table.
	* donrails/tool/tables-mysql.sql: Add entry for this. 
	(TODO): table for postgresql and sqlite.	
	* donrails/app/models/enrollment.rb: New model for it. (has_many :article)
	* donrails/app/models/article.rb: Add belongs_to :enrollment.
	* donrails/app/controllers/login_controller.rb 
	(LoginController::add_article): Change for this feature.
	(LoginController::fix_article): likewise.
	(LoginController::manage_article): likewise.
	* donrails/app/views/login/manage_article.rhtml: likewise.
	* donrails/app/views/login/new_article.rhtml: likewise.
	* donrails/app/views/login/form_article.rhtml: likewise.
	* donrails/test/unit/article_test.rb (ArticleTest): new test for it.
	* donrails/test/fixtures/enrollments.yml:  likewise.
	* donrails/test/fixtures/articles.yml: Add entry for it.

	* donrails/app/controllers/login_controller.rb (LoginController::manage_article): Add to hyde 'article.hidden = 1' articles.
	* donrails/app/views/login/manage_article.rhtml: likewise.

2006-09-02  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/views/login/form_article.rhtml: Add checkbox to hyde article.
	* donrails/app/controllers/login_controller.rb (LoginController::fix_article): Change for this.
	(LoginController::add_article): likewise.
	* donrails/app/views/login/new_article.rhtml: likewise.

2006-08-31  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/models/category.rb (Category): Cleanup.

2006-08-30  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/controllers/notes_controller.rb (NotesController::show_category): Fix: When donrails is inputted non existent category id or name.
	(NotesController::afterday): Clean up.

2006-08-28  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/views/notes/search.rhtml: Add: 'link_to' to show_title.

2006-08-26  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* Fixed: http://code.google.com/p/donrails/issues/detail?id=7
	* donrails/app/models/comment_mailer.rb (CommentMailer::notify): Change to show url in which commentor/trackbacker comment.
	* donrails/app/views/comment_mailer/notify.rhtml: likewise.
	* donrails/test/unit/trackback_test.rb (TrackbackTest): Test for it.
	* donrails/test/unit/comment_test.rb (CommentTest): Test for it.

2006-08-24  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/views/notes/show_title.rhtml: Add div.nndate entry.
	* donrails/app/views/notes/noteslist.rhtml: likewise.
	* donrails/public/stylesheets/araki.css: likewise.

	* donrails/app/controllers/login_controller.rb (LoginController::delete_article): Fix: When user input to delete/hide non exits id articles. Added check article exists or not before delete/hide.
	* donrails/test/functional/login_controller_test.rb (LoginControllerTest::test_delete_article): Add test for it.

	* donrails/app/models/article_sweeper.rb (ArticleSweeper::expire_for): Fix cache sweep for show_category_noteslist.

	* donrails/config/routes.rb: Add routing for show_category_noteslist pagination.

2006-08-23  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/models/comment_mailer.rb (CommentMailer::notify): Fix when ADMIN_MAILADD is not defined. (Thanks \ay.)

	* donrails/config/routes.rb: Add routing for show_category pagination.

	* donrails/app/models/article_sweeper.rb (ArticleSweeper::expire_for): Fix cache sweep for show_category.

2006-08-15  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/helpers/application_helper.rb: Fix: When image_dump path is not existed.

2006-08-05  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/views/notes/rdf_recent.rxml: Encode change to UTF-8.

	* donrails/app/views/shared/authorhead.rhtml: Encode change to UTF-8.

	* donrails/app/controllers/notes_controller.rb (NotesController::show_image): Fix. In case for wrong (non exist) id number is imputted.

2006-08-03  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/controllers/login_controller.rb (LoginController::banlist_test_by_ar_string): Fix. I mistake column name in trackback table (wrong: blogname, correct: blog_name).

2006-08-02  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/test/functional/notes_controller_test.rb (NotesControllerTest::test_indexabc): Add to test this fix.

	* donrails/app/controllers/notes_controller.rb (NotesController::indexabc): Fix for parameter parse.

2006-08-02  Akira TAGOH  <at@gclab.org>

	* donrails/tool/plugin-setup.rb: add --force option for installer.

2006-08-02  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* README.cache: Add new file.

	* donrails/app/controllers/notes_controller.rb (NotesController::noteslist): Cleanup.

	* donrails/config/routes.rb: More restrict for routing to 'indexabc'.

	* donrails/test/functional/notes_controller_test.rb (NotesControllerTest::test_dateparse): Remove test for NotesController::dateparse.

	* donrails/app/controllers/notes_controller.rb (NotesController::dateparse): Remove this method. Change to process wrong input by httpd (mod_rewrite).

	* Makefile (linkinit): Add copy from example/{notes,index}.rhtml.

	* donrails/example/donrails_env.rb: Update for applying 1.2.

	* INSTALL.ja: Add example.

2006-07-29  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* Makefile (plugin): Add to set secutity_extensions plugin.

2006-07-28  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* SVN repository will remove to google code hosting.
	svn checkout http://donrails.googlecode.com/svn/trunk/ donrails

2006-07-27  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/public/stylesheets/araki.css: Some change: table and pre setting.

	* donrails/public/stylesheets/login.css: Some change: table and pre setting.

	* donrails/app/views/notes/catch_trackback.rxml: Rename from catch_ping.

	* donrails/app/views/notes/catch_ping.rxml: New file.

	* donrails/app/controllers/notes_controller.rb 
	(NotesController::catch_ping): New method. 
	(NotesController::catch_trackback): Rename from catch_ping.

	* donrails/app/models/article.rb 
	(Article::send_pings2): Change to invoke NEW ping.send_ping2.
	(Article::send_trackback): New method. It invokes ping.send_trackback.

	* donrails/app/models/ping.rb 
	(Ping::send_trackback): Rename send_ping2 to send_trackback. This method is used to send trackback.
	(Ping::send_ping2): Change behavior: This method is used to send ping to ping hub (cf. feedburner). Now support REST version which defined in http://www.weblogs.com/api.html#7. Todo: XML-RPC version.

	* donrails/test/unit/ping_test.rb (PingTest::test_send_trackback): New test.

	* donrails/test/unit/article_test.rb (ArticleTest::test_send_trackback): New test.

	* donrails/app/models/article.rb (Article::send_trackback): Rename method from send_ping2.

2006-07-25  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/controllers/login_controller.rb (LoginController::delete_comment): Fix: When change hidden status, existed trackback is filtered by antispam. (Change to use save -> update_attribute)
	(LoginController::delete_trackback): likewise.
	(LoginController::delete_picture): likewise.
	(LoginController::form_article): Fix to show wrong id entry.

	* donrails/test/fixtures/trackbacks.yml (third_trackback): Fixture added for this change.

	* donrails/test/functional/login_controller_test.rb (LoginControllerTest::test_delete_trackback): Test added for this change.

	* donrails/app/controllers/login_controller.rb (LoginController::delete_trackback): Fix: When change hidden status, existed trackback is filtered by antispam. (Change to use save -> update_attribute)

	* donrails/app/models/article.rb (Article::sendping): likewise.

	* donrails/app/controllers/login_controller.rb (LoginController::manage_blogping): Fix if BASEURL is not defined.

	* donrails/test/functional/login_controller_test.rb (LoginControllerTest::test_delete_blogping): Add some test.

	* donrails/app/views/notes/sitemap.rxml: Cleanup.

2006-07-24  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/test/functional/login_controller_test.rb (LoginControllerTest::test_add_blogping): Add assert_equal test.

	* donrails/test/unit/article_test.rb (ArticleTest::test_sendping): Test for article.sendping.

	* donrails/app/models/article.rb (Article::sendping): New(re-enable) method for sending ping.

	* donrails/app/views/login/manage_blogping.rhtml: add to show @flash[:note2] text.
	* donrails/app/views/login/manage_ping.rhtml: add to show @flash[:note2] text.

2006-07-22  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/config/routes.rb: add entry for :sitemap.

	* donrails/app/models/article_sweeper.rb (ArticleSweeper::expire_for): Add cleaning entry for :sitemap .

	* donrails/app/controllers/notes_controller.rb (NotesController): Add entry 'caches_page :sitemap'.

	* donrails/test/functional/notes_controller_test.rb (NotesControllerTest::test_sitemap): add test.

	* donrails/app/controllers/notes_controller.rb (NotesController::sitemap): New method for Google sitemap (http://www.google.com/webmasters/sitemaps/docs/en/protocol.html).

2006-07-20  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/test/functional/notes_controller_test.rb (NotesControllerTest::test_dateparse): add test.

2006-07-18  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/controllers/login_controller.rb (LoginController::delete_{picute,trackback,comment,article}): Change to show checkbox checked or not checked.
	* donrails/test/functional/login_controller_test.rb (LoginControllerTest::test_delete_{picute,trackback,comment,article}): Change to test for this change.


	* donrails/test/functional/login_controller_test.rb (LoginControllerTest::test_add_category): Added test: When add to a category under other category.

	* donrails/app/controllers/login_controller.rb (LoginController::add_category): Fixed: When add to a category under other category.

2006-07-18  Akira TAGOH  <at@gclab.org>

	* donrails/lib/modules/wiliki.rb (DonRails::Wiliki::body_to_html):
	fixed to not generate the unexpected html with the blockquote and
	one-liner pre syntax.

	* donrails/app/controllers/notes_controller.rb (articles_long):
	check hidden flag to find articles.
	(articles_author): likewise.
	(noteslist): likewise.
	(show_category): likewise.

2006-07-18  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/views/notes/noteslist.rhtml: cleanup.

	* donrails/app/controllers/notes_controller.rb (NotesController::show_month): Fix to hyde when articles.hidden is 1.
	(NotesController::show_nnen): likewise.
	(NotesController::show_nnen): likewise.
	(NotesController::show_title): likewise.
	(NotesController::afterday): likewise.
	(NotesController::tendays): likewise.
	(NotesController::add_comment2): likewise.

	* donrails/test/unit/article_test.rb (ArticleTest::test_send_pings2): New test method.

2006-07-17  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/test/unit/ping_test.rb (PingTest::test_send_ping2): New test method.

	* donrails/test/unit/article_test.rb (ArticleTest::test_renew_mtime): New test method.
	(ArticleTest::test_search): New test method.

2006-07-14  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/views/shared/comment-form.rhtml: Change to use don_get_object(article, 'xml') for remove HTML tag at title.

	* donrails/app/controllers/notes_controller.rb (NotesController::add_comment2): Add '\n' at end of error output.

	* donrails/app/controllers/login_controller.rb (LoginController): Add mothods which are checked by cache_sweeper. Chage for apply Article.hidden.

	* donrails/app/controllers/atom_controller.rb: Chage for apply Article.hidden.

2006-07-13  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/test/functional/notes_controller_test.rb (NotesControllerTest::test_add_comment2): Add test.

	* donrails/app/controllers/notes_controller.rb (NotesController::add_comment2): likewise.

	* donrails/app/controllers/login_controller.rb (LoginController::add_article): Change: When invalid input which is judged by article.valid? is coming, return 403.

	* donrails/app/models/comment.rb (Comment): likewise.

	* donrails/app/models/trackback.rb (Trackback): Change to invoke 'notify_by_mail' timing from after_save for after_create.
	

	* donrails/test/functional/notes_controller_test.rb (NotesControllerTest::test_rdf_article): add test for missing :id.

	* donrails/app/controllers/notes_controller.rb (NotesController::rdf_article): Chage for apply Article.hidden.
	(NotesController::rdf_recent): likewise.
	(NotesController::rdf_category): likewise.
	(NotesController::recent): likewise.
	(NotesController::recent_trigger_title_a): likewise.

2006-07-12  Akira TAGOH  <at@gclab.org>

	* donrails/lib/modules/wiliki.rb (DonRails::Wiliki::body_to_html):
	fixed to parse [link name] syntax properly.

2006-07-12  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/models/article.rb (Article::self.search): Chage for apply Article.hidden.

	* donrails/app/controllers/notes_controller.rb (NotesController::rdf_recent): Chage for apply Article.hidden.

	* donrails/app/views/shared/comment2.rhtml: Fix for apply Comment.hidden and Tracback.hidden.

	* donrails/app/views/shared/comment-noadd.rhtml: Fix for apply Comment.hidden and Tracback.hidden.

	* donrails/public/stylesheets/login.css: Change table font-size.

	* donrails/test/functional/login_controller_test.rb (LoginControllerTest::test_delete_comment): test for comment.hidden.

	* donrails/app/controllers/login_controller.rb (LoginController::delete_comment): Change to support Comment.hidden.

	* donrails/app/views/shared/table_trackback.rhtml: New file.

	* donrails/app/views/shared/add_banlist.rhtml: Change to use table_comment.rhtml.

	* donrails/app/views/shared/table_comment.rhtml: New file.

2006-07-11  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/test/functional/login_controller_test.rb (LoginControllerTest::test_delete_picture_2): test for picture.hidden.

2006-07-10  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/test/functional/notes_controller_test.rb (NotesControllerTest::test_show_image): test for Picture.hidden.

	* donrails/app/controllers/notes_controller.rb (NotesController::show_image): likewise.

	* donrails/app/controllers/login_controller.rb (LoginController::delete_picture): likewise

	* donrails/test/fixtures/pictures.yml (second): likewise.

	* donrails/app/views/login/manage_picture.rhtml: Change to support Picture.hidden.

	* donrails/tool/tables-{postgresql,sqlite,mysql}: add hidden column in picutures,comments,articles,trackbacks.


2006-07-09  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/public/stylesheets/login.css: Change for display add_banlist.rhtml
	* donrails/app/views/shared/add_banlist.rhtml: fix for changing test_banlist.
	* donrails/app/controllers/login_controller.rb 
	add test file for all methods.
	(LoginController::delete_comment): Fix for no @params['deleteid']
	(LoginController::form_article): Fix for no @params['pickid']
	(LoginController::fix_article): Fix for not enough input.
	(LoginController::banlist_test_by_ar): Fix for not enough input.
	(LoginController::test_banlist): Fix for not enough input.
	(LoginController::add_blogping): Fix for not enough input.
	(LoginController::add_author):  Fix for not enough input.

2006-07-08  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/controllers/login_controller.rb 
	(LoginController::test_banlist): Change redirect_to 'manage_banlist' to :back.
	(LoginController::add_banlist): likewise.
	(LoginController::authenticate): Fix for wrong POST.
	(LoginController::add_category): Fix for no @paramas["category"].
	(LoginController::manage_picture_detail): Fix for no @params['id']
	(LoginController::delete_picture): Remove picture_get method.

2006-07-07  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/lib/antispam.rb (AntiSpam::scan_uri): Cleanup.

	* donrails/lib/antispam_test.rb: New file for test.

2006-07-04  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/views/notes/pick_trackback_a.rhtml: New file.

	* donrails/app/controllers/notes_controller.rb (NotesController::pick_trackback_a): New method.

2006-07-02  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/controllers/login_controller.rb (LoginController::add_banlist): Add to check pattern match before add Banlist.

	* donrails/lib/antispam.rb (AntiSpam::scan_text): Fix: Banlist condition consists regexp and string is swapped.

	* donrails/app/controllers/login_controller.rb (LoginController::banlist_test_core): New private method.

2006-07-01  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* VERSION: up to 1.1.1.

	* donrails/app/controllers/login_controller.rb (LoginController::test_banlist): New method. It is used for checking Banlist entry.
	* donrails/lib/antispam.rb (AntiSpam::scan_ipaddr): Fix to calling scan_ipaddr_white.
	* donrails/app/views/login/manage_trackback.rhtml: Fix to display invlid format of trackback entry.
	* donrails/app/views/shared/add_banlist.rhtml (format): Add test_banlist form.

2006-06-28  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* README_1.1.html: New file.
	* VERSION: up to 1.1.0

	* donrails/app/controllers/notes_controller.rb (NotesController::show_image): Change: If $IMAGE_BASE_PATH is setted in donrails_env.rb, redirect_to image under $IMAGE_BASE_PATH. (Request from tagoh.)
	* donrails/app/helpers/application_helper.rb (ApplicationHelper::display_article_images): likewise.
	* INSTALL.ja: Add related document.


2006-06-25  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/views/atom/feed.rxml: Fix: spelling.

	* donrails/tool/tables-{postgresql,sqlite}.txt: Add Banlist.white.

	* donrails/app/views/atom/feed.rxml: Add image link.

	* donrails/app/views/notes/rdf_{article,search,category,recent}.rxml: Add 'image:item'.

2006-06-24  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/helpers/application_helper.rb (ApplicationHelper::display_article_date): Change to check existence of article_date.
	(ApplicationHelper::display_article_categories): Fix for category name is not inputted.

2006-06-23  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/views/login/manage_comment.rhtml: Change to use 'add_banlist.rhtml'.

	* donrails/app/views/shared/add_banlist.rhtml: New file.
	* donrails/app/views/login/manage_banlist.rhtml: Change to use 'add_banlist.rhtml'.
	* donrails/app/views/login/manage_trackback.rhtml: likewise.
	
	* donrails/app/views/login/manage_trackback.rhtml: Fix: If article which is trackbacked somebody is not exist, now donrails shows 'deleted article'.

	* donrails/tool/tables-mysql.sql: **PLEASE*** Add 'white' column in 'banlists' table. (See UPGRADE1.1)
	* donrails/lib/antispam.rb (AntiSpam::scan_ipaddr_white): New method for ipaddr whitelist.
	* donrails/test/functional/notes_controller_test.rb (NotesControllerTest::test_trackback__3): Net test method for it.
	* donrails/app/views/login/manage_banlist.rhtml: Change for apply ipaddr whitelist.
	* donrails/app/controllers/login_controller.rb (LoginController::add_banlist): likewise.

	* donrails/app/controllers/notes_controller.rb (NotesController::trackback): Fix: When donrails receives unconditionl trackback like SPAM, send error response. (In last code, just ignore. Just send success response like good trackback.)
	* donrails/test/functional/notes_controller_test.rb (NotesControllerTest::test_trackback__2): New test method for it.
	
2006-06-15  Akira TAGOH  <at@gclab.org>

	* donrails/lib/antispam.rb (AntiSpam::initialize):
	don't rely on Exceptions to set default values for IP_RBL, HOST_RBL
	and URL_LIMIT.

2006-06-09  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/controllers/notes_controller.rb (NotesController::show_image): Fix to show picture.

2006-06-06  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/helpers/application_helper.rb (ApplicationHelper::display_article_date): New method.
	(ApplicationHelper::display_article_categories): New method.
	(ApplicationHelper::display_article_images): New method.

	* donrails/app/views/notes/noteslist.rhtml: Change to use display_article_date, display_article_categories and display_article_images.
	* donrails/app/views/notes/pick_article_a.rhtml: likewise.
	* donrails/app/views/notes/pick_article_a2.rhtml: likewise.

	* donrails/app/views/shared/recent_category.rhtml: Remove file. This file is not used. And this file is empty.

	* donrails/app/helpers/application_helper.rb (ApplicationHelper::display_categories_roots_ul_description): Remove GC.
	(ApplicationHelper::display_categories_roots_ul): likewise.

2006-06-01  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/views/notes/comment_form.rhtml: Fix Kanji-code.

2006-05-31  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/views/notes/show_title.rhtml: Change to use shared/comment to shared/comment2.

	* donrails/app/views/notes/comment_form.rhtml: Add new file. Becase anti CSRF does conflict comment adding under cache is on. This file is alternative for comment_form_a.rhtml.
	* donrails/app/controllers/notes_controller.rb (NotesController::comment_form): likewise. New method.
	* donrails/app/views/shared/comment2.rhtml: likewise. Chenge link_to_remote from 'comment_form_a' to 'comment_form'. 
	- passed through CGI.escapeHTML to show trackback entry.

2006-05-31  Akira TAGOH  <at@gclab.org>

	* donrails/app/views/login/manage_category.rhtml: removed a duplicate
	column of name.

	* donrails/app/views/login/manage_banlist.rhtml: passed through
	CGI.escapeHTML.

2006-05-30  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/models/article_sweeper.rb (ArticleSweeper::expire_for): Fix: I have lacked to add expire method which is kicked by comment or trackback update.
	(ArticleSweeper): likewise: Add observe for 'Comment' and 'Trackback'.

	* donrails/lib/antispam.rb (AntiSpam::initialize): Change: If IP_RBL, HOST_RBL and URL_LIMIT are not defined in donrails_env.rb, use default parameters.

	* donrails/test/functional/notes_controller_test.rb (NotesControllerTest::test_add_comment2_not): New test.
	(NotesControllerTest::test_add_comment2_1): New test.
	(NotesControllerTest::test_add_comment2): New test.

2006-05-29  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* UPGRADE_1.1.ja: Add notice for anti-spam related parameters.
	
	* UPGRADE_1.1.ja: Add request for changing table name from blacklists to banlists.(Thanks tagoh)

	* donrails/app/views/shared/comment-form.rhtml: Fix: Comment's response is 403. (Thanks tagoh)

2006-05-28  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/controllers/login_controller.rb (LoginController::add_article): Change to use author_name and category_name auto completion.
	* donrails/app/views/login/new_article.rhtml: likewise. 
	* donrails/app/views/layouts/login.rhtml: likewise. Add {effects,controls}.js.

2006-05-27  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/models/article.rb (Article::renew_mtime): New method. It updates 'article_mtime' before_save.
	* donrails/app/controllers/login_controller.rb (LoginController::add_article): Remove "article_mtime" update.


	* donrails/app/views/login/manage_article.rhtml: Add to show article_mtime.

	* donrails/app/controllers/notes_controller.rb (NotesController::rdf_recent): Change to show from recent 'id' to recent 'article_mtime'.

	* donrails/app/views/login/manage_category.rhtml: Some change.

	* donrails/app/controllers/login_controller.rb (LoginController::manage_category): Fix to find parent category.

2006-05-26  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/controllers/application.rb (ApplicationController::clean_memory): New method. It invoke GC.start.
	* donrails/app/controllers/notes_controller.rb (NotesController): call clean_memory for GC.
	* donrails/app/controllers/atom_controller.rb (AtomController): likewise.

	* donrails/app/helpers/application_helper.rb (ApplicationHelper::display_categories_roots_ul): Add GC.start. Is it memory leak?
	(ApplicationHelper::display_categories_roots_ul_description): likewise.

2006-05-25  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* ((NOTICE)): I will change to apply for Category model use from acts_as_tree to acts_as_nested_set. ActiveRecord::Acts::NestedSet::ClassMethods is better module.
  	* donrails/app/models/{category,comment}.rb: Change to apply for Category model use acts_as_tree.
	* donrails/app/controllers/login_controller.rb: likewise.
	* donrails/app/controllers/notes_controller.rb: likewise.
	* donrails/app/views/layouts/login.rhtml: likewise.

	* donrails/tool/tables-mysql.sql: New files for MySQL.
	
2006-05-21  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/models/comment.rb (Comment): Fix at validates_length_of. Remove :too_short message.

2006-05-19  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* ((IMPORTANT CHANGE)): Change table name 'blacklist' to 'banlists'. Because 'blacklists' is reserved by Rails1.1.
	* donrails/tool/tables-sqlite.txt: likewise.
	* donrails/app/controllers/login_controller.rb: likewise.
	* donrails/app/models/banlist.rb: likewise
	* donrails/tool/tables-postgresql.txt: likewise
	* donrails/app/views/login/manage_blacklist.rhtml: Remove. likewise.
	* donrails/app/views/login/manage_banlist.rhtml: Add. likewise.
	* donrails/lib/antispam.rb: likewise.

	* donrails/test/fixtures/*.yml: New files.
	* donrails/test/*: Refine test related files. Many files are added or changed.

	* ((Let's start modify codes for running on rails 1.1))

2006-05-18  Akira TAGOH  <at@gclab.org>

	* donrails/app/controllers/login_controller.rb (new_article):
	follow the previous article to determine the default format style.

2006-05-17  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/views/login/manage_article.rhtml: Some fix..

	* donrails/app/controllers/notes_controller.rb (NotesController): refine cache_sweeper and verify_form_posts_security_token entry.

	* donrails/app/controllers/login_controller.rb (LoginController): refine cache_sweeper entry.

2006-05-16  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/controllers/notes_controller.rb (NotesController): Fix: I lacked to add cache for :recent_category_title_a.

	* UPGRADE_1.1.ja: Add information for adding parent_id column in Categories TABLE.

2006-05-16  Akira TAGOH  <at@gclab.org>

	* donrails/tool/hnf2db.rb: load environment.rb and removed an
	abosolute path to activerecord. now it depends on RoR where you setup
	from.

2006-05-13  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/controllers/notes_controller.rb (NotesController::category_tree_list_a): New method.
	(NotesController::show_category): Add to find by Category.id. And add to find by without category.

	* donrails/app/controllers/login_controller.rb (LoginController::manage_category): New method.
	(LoginController::add_category): New method.
	(LoginController::delete_category): New method.
	(LoginController::manage_author): Add to find by Author.id.
	(LoginController::edit_author): Remove method.

	* donrails/app/models/article_sweeper.rb (ArticleSweeper::expire_for): Add entry for category_tree_list_a.

	* donrails/app/helpers/application_helper.rb (ApplicationHelper::display_categories_roots_ul): New method.
	(ApplicationHelper::display_categories_roots_ul_description): New method.

	* donrails/app/controllers/notes_controller.rb (NotesController::show_category): Add. Now you can link category entry by show_category/:id.
	Some change for category_tree_list_a.

2006-05-12  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/views/layouts/login.rhtml: Add link to manage_category.

2006-05-11  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/models/category.rb (Category): Add acts_as_tree.
	* donrails/tool/tables-postgresql.txt: likewise
	* donrails/tool/tables-sqlite.txt: likewise

2006-05-08  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/views/notes/rdf_recent.rxml: Fix for formated body.
	* donrails/app/views/notes/rdf_search.rxml: likewise.
	* donrails/app/views/notes/rdf_category.rxml: likewise.
	* donrails/app/views/notes/rdf_article.rxml: likewise.
	* donrails/lib/modules/html.rb (DonRails::HTML::body_to_xml): likewise. Fix for using HTree.
	* donrails/lib/modules/wiliki.rb (DonRails::Wiliki::body_to_xml): likewise.
	* donrails/lib/modules/hnf.rb (DonRails::HNF::body_to_xml): likewise.
	* donrails/lib/modules/rd.rb (DonRails::RD::body_to_xml): likewise.

2006-04-28  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/lib/antispam.rb (AntiSpam::is_spam): Fix. I lacked to describe Trackback.ip.

2006-04-27  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/lib/antispam.rb (AntiSpam::initialize): 
	- Add niku.2ch.net for @IP_RBL.
	- Change to costomize for antispam. You can configure IP_RBL, HOST_RBL and URL_LIMIT.

	* donrails/app/views/atom/feed.rxml: Fix link.

	* donrails/config/routes.rb: Fix for Atom feed.

	* donrails/app/controllers/atom_controller.rb (AtomController): Cleanup.

	* donrails/app/views/notes/rdf_category.rxml: likewise.

	* donrails/app/views/notes/rdf_recent.rxml: likewise.

	* donrails/app/views/notes/rdf_article.rxml: likewise.

	* donrails/app/views/atom/feed.rxml: Fixed. If @article had not aritcle_mtime, some error caused.

2006-04-26  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/models/trackback.rb (Trackback): Fixed. Before this fix, validates_antispam is run only for :url.
	* donrails/app/models/comment.rb (Comment): likewise.
	* donrails/lib/antispam.rb (AntiSpam::is_spam): likewise.

	* donrails/lib/antispam.rb (AntiSpam::initialize): Change to costomize for antispam. You can configure @IP_RBL, @HOST_RBL and @URL_LIMIT.

	* donrails/app/controllers/notes_controller.rb (NotesController::add_comment2): Fix: If no parameters are inputted, redirect to 'noteslist'.

2006-04-24  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/models/trackback.rb (Trackback::notify_by_mail): If new comment or trackback coming, send notify by mail to ADMIN_MAILADD.
	* donrails/app/models/comment_mailer.rb (CommentMailer::notify): likewise.
	* donrails/app/views/comment_mailer/notify.rhtml: likewise.
	* donrails/app/models/comment.rb (Comment::notify_by_mail): likewise.
	* NEWS, NEWS.ja: likewise.
	
	* donrails/app/models/{trackback,comment}.rb: Japanese text code convert to utf8.
	* donrails/app/views/shared/comment-form.rhtml: Change to show 'password is required.' for posting comment.

2006-04-21  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/views/shared/comment.rhtml: Change to show Comment.date.

	* donrails/app/views/shared/comment2.rhtml: Change to show Comment.date.

	* donrails/app/controllers/notes_controller.rb (NotesController::noteslist): Fix if article does not have ariticle_mtime.
	(NotesController::recent): likewise.
	(NotesController::show_category): likewise.
	... and many part ...

2006-04-04  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/controllers/login_controller.rb (LoginController::fix_article): Change to change Ariticle.author.

2006-04-03  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/controllers/login_controller.rb (LoginController::fix_article): Change to change Article.article_date.

2006-03-27  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* rails/app/controllers/login_controller.rb (LoginController::edit_picture): New method. In order to edit picture related information.
	(LoginController::manage_picture_detail): likewise.

2006-03-22  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/views/layouts/login.rhtml: add link to manage_article.

	* donrails/app/controllers/login_controller.rb (LoginController::picture_save): If success, redirect to manage_picture.

	* donrails/app/views/login/manage_picture.rhtml: Change to show small image by '<img width=100 ..>'. Add file delete checkbox.

	* donrails/app/controllers/login_controller.rb (LoginController::delete_article): At delete article, remove picture.article_id.
	(LoginController::delete_picture): New method.
	(LoginController::manage_picture): New method.

2006-02-18  araki yasuhiro  <yasu@debian.or.jp>

	* donrails/app/views/login/manage_article.rhtml: Change to add image link.

	* donrails/app/views/login/form_article.rhtml: Change to re-edit relation of articles and categories.

	* donrails/tool/atomclient/atomcheck.rb: Some change for add relation of article and image.

	* donrails/tool/atomclient/atommail.rb: Change to apply for MIME multipart message.

2006-02-16  araki yasuhiro  <yasu@debian.or.jp>

	* donrails/app/controllers/notes_controller.rb (NotesController::show_image): New method.

	* donrails/app/controllers/login_controller.rb (LoginController::fix_article): NEW feature: Article.categories can be changed.

	* donrails/app/controllers/atom_controller.rb (AtomController::image_post): New method.

	* donrails/app/models/picture.rb (Picture): Add belongs_to article.

	* donrails/app/models/article.rb (Article): Add relation to 'pictures'. 
	* donrails/app/models/image.rb: New models. It use 'pictures' table.

	* NEWS.ja: add new feature information.

	* UPGRADE_1.1.ja: Add new table information on pictures table. 
	** NOTICE ** You shuld add 'article_id' column in picures table.
	- donrails/tool/tables-{sqlite,postgresql}.txt: likewise.

2006-02-12  araki yasuhiro  <yasu@debian.or.jp>

	* donrails/app/views/atom/image_post.rxml: New file. It include alternate link to show_title, show_image and image_post.

	* donrails/app/helpers/application_helper.rb (ApplicationHelper::atom_parse_image): New method.

2006-02-10  araki yasuhiro  <yasu@debian.or.jp>

	* donrails/app/controllers/notes_controller.rb (NotesController::show_image): New method.
	* NEW feature: Image post by AtomAPI. 

2006-02-08  araki yasuhiro  <yasu@debian.or.jp>

	* donrails/tool/atomclient/atommail.rb (reportmail): If some error raise in AtomPost::atompost, send error report mail.

	* donrails/tool/atomclient/atomcheck.rb (AtomPost::atompost): If refused by AtomAPI server, raise Errono::ECONNREFUSED. (path through from Net::HTTP.)

	* donrails/tool/atomclient/README.ja: New file.

2006-02-07  araki yasuhiro  <yasu@debian.or.jp>

	* donrails/tool/atomclient/atommail.rb 
	New config parameter: 
	'report_mailaddress': (reportmail): New method. If this parameter setted, it sends report to 'report_mailaddress' which configured in ~/.donrails/atompost.yaml.
	'certify_mailaddress': If this parameter setted, it restricts article update from this mailaddress only.
	'category': If this paramter setted, it adds <category/> in AtomAPI POST message.

2006-02-06  araki yasuhiro  <yasu@debian.or.jp>

	* Makefile: Add dist rule.

2006-02-04  araki yasuhiro  <yasu@debian.or.jp>

	* donrails/app/controllers/login_controller.rb (LoginController::authorize): This method was Changed to protected.

2006-02-02  araki yasuhiro  <yasu@debian.or.jp>

	* donrails/tool/atomclient/tables.sql: New file.

	* README.3rdparty: Add a security_extensions plugin install method.

	* donrails/app/views/notes/rdf_*.rxml: Add <trackback/>, <category/> and <copyright/>
	* donrails/app/views/atom/feed.rxml: Add <generator/>, <copyright>, <tagline/> and <modified/>.

	* donrails/app/controllers/login_controller.rb 
	(LoginController): Change to use
	verify_form_posts_have_security_token. Tamper for CSRF. Please see
	README.3rdparty.
	(LoginController::picture_save): Change to return 406 when picture upload was failed.
	(LoginController::picture_save): Fixed typo.

	* donrails/app/views/login/new_article.rhtml: Change tampering for CSRF. Change to use verify_form_posts_have_security_token. 'form_tag' -> 'secure_form_tag'. 
	* donrails/app/views/shared/edit_author.rhtml: likewise.
	* donrails/app/views/login/manage_trackback.rhtml: likewise.
	* donrails/app/views/login/manage_comment.rhtml: likewise.
	* donrails/app/views/login/manage_author.rhtml: likewise.
	* donrails/app/views/login/manage_blacklist.rhtml: likewise.
	* donrails/app/views/login/manage_blogping.rhtml: likewise.
	* donrails/app/views/login/manage_article.rhtml: likewise.
	* donrails/app/views/login/form_article.rhtml: likewise.
	* donrails/app/views/login/index.rhtml: likewise. 

2006-02-01  araki yasuhiro  <yasu@debian.or.jp>

	* donrails/app/controllers/login_controller.rb (LoginController::authorize): Change to reset session. Tamper for CSRF.
	(LoginController::authenticate): likewise.
	(LoginController::logout): likewise.

	* Check tags (revision 167) 'pre-CSRF'. 

	* donrails/tool/tables-postgresql.txt: *** NOTICE: NEW COLUMN in authors TABLE ***. Add new column as Author.summary. This column stores short information of each author.
	* donrails/tool/tables-sqlite.txt: likewise.
	* UPGRADE_1.1: likewise.
	* donrails/app/views/login/manage_author.rhtml: likewise. And change to use shared/edit_author.
	* donrails/app/views/login/edit_author.rhtml: likewise. New file.
	* donrails/app/views/shared/edit_author.rhtml: likewise. New file.

2006-01-31  araki yasuhiro  <yasu@debian.or.jp>

	* donrails/app/controllers/notes_controller.rb (NotesController::articles_author): New method.
	* donrails/app/models/article_sweeper.rb (ArticleSweeper::expire_for): likewise.
	* donrails/app/views/shared/authorhead.rhtml: likewise. Add link_to NOtesController::artilces_author.

2006-01-30  araki yasuhiro  <yasu@debian.or.jp>

	* donrails/app/views/atom/feed.rxml: Fixed typo.

	* donrails/app/controllers/atom_controller.rb (AtomController): New feature: page cache of /atom/feed.xml.
	* donrails/app/models/article_sweeper.rb (ArticleSweeper::expire_for): likewise.
	* UPGRADE_1.1: likewise.	
	* donrails/config/routes.rb: likewise.	

	* donrails/example/notes.rhtml: Update to use link of AtomAPI feed.

2006-01-27  araki yasuhiro  <yasu@debian.or.jp>

	* donrails/app/models/article_sweeper.rb (ArticleSweeper::expire_for): add expire method for recent_trigger_title.

	* donrails/app/views/notes/category_select_a.rhtml: remove static <form />.
	* donrails/app/views/shared/comment-form.rhtml: likewise
	* donrails/app/views/login/index.rhtml: likewise 

	* UPGRADE_1.1: Add information to articles and authors table's column.

	* donrails/app/models/article_sweeper.rb (ArticleSweeper::expire_for): delete for recent_category_title_a.

	* donrails/app/controllers/notes_controller.rb (NotesController): Change to suse caches_page for NotesController::category_select_a and NotesController::recent_category_title_a.

	* donrails/app/views/shared/category_select.rhtml: Change to call remote_function by HTTP GET. (Change from HTTP POST).
	* donrails/app/views/shared/trigger_title_list.rhtml: likewise.
	* donrails/app/views/shared/category_title_list.rhtml: likewise.
	
	* donrails/tool/atomclient/atomcheck.rb 
	(AtomPost::atompost): Fix typo.
	(AtomPost::atompost): If connection to server is refused, show refuse message.

	* donrails/app/controllers/atom_controller.rb 
	(AtomController::feed): Change response for non-POST request.
	(AtomController::wsse_auth): Change response code: If wsse fail, return 401.
	(AtomController::feed): Change response code: If does not exist requested uri, return 403.
	(AtomController::post): Change response code: If some trouble (cf. input parse error), return 400.
	(AtomController::edit): likewise.
	(AtomController::edit): Change response for non DELETE or PUT request. Then return 502.

2006-01-26  araki yasuhiro  <yasu@debian.or.jp>

	* donrails/app/views/atom/post.rxml: Change to add <author><name></name></author> and <content/>.
	* donrails/app/views/atom/index.rxml: 
	- Remove: entry to 'not NEW' article.
	- Remove (comment out): link to service.categories

	* donrails/app/controllers/atom_controller.rb (AtomController::feed): Apply for paginate.

	* donrails/app/views/atom/feed.rxml: 
	- Apply for AtomAPI(feed) response. (Refrence: so-net blog API response)
	- Apply for paginate.
	

2006-01-25  araki yasuhiro  <yasu@debian.or.jp>

	* rails/app/views/shared/comment-form.rhtml: remove input form for url. Because nobody use this.

	* donrails/lib/antispam.rb (AntiSpam::scan_uri_format): New method. If uri is ended without path (cf, http://araki.net/), reject this posts as comment and trackback.

2006-01-24  araki yasuhiro  <yasu@debian.or.jp>

	* rails/app/controllers/notes_controller.rb (NotesController::tendays): Change to return 404, if no article to show.

	* rails/test/functional/notes_controller_test.rb (NotesControllerTest::test_tendays): likewise

2006-01-23  araki yasuhiro  <yasu@debian.or.jp>

	* rails/app/controllers/notes_controller.rb 
	(NotesController::show_title): Change to return 404, if no article to show.
	(NotesController::show_category): likewise.
	(NotesController::show_category_noteslist): Clean up.

	* rails/test/functional/notes_controller_test.rb
	(NotesControllerTest::test_show_title__[2-6]) and (NotesControllerTest::test_show_title): New test methods.
	(NotesControllerTest::test_show_category__2) and (NotesControllerTest::test_show_category): 

2006-01-21  araki yasuhiro  <yasu@debian.or.jp>

	* donrails/app/controllers/atom_controller.rb (AtomController): Fix un-sweep cached content.

	* donrails/app/controllers/login_controller.rb (LoginController::delete_unwrite_author): Fixed to change Author.writable = 0 or 1.

	* donrails/app/models/trackback.rb (Trackback): Cleanup.

	**** PLEASE CHECK YOUR authors TABLE on your Database. ****
	* ADD NEW column in authors and articles table.(authors.nickname, articles.author_id). ADD restriction to authors.name is unique. 
	* donrails/app/models/article.rb (Article): add relation to author.
	* donrails/tool/tables-sqlite.txt: add author_id column in articles table.(alter table articles add column author_id INTEGER;)
	* donrails/tool/tables-postgresql.txt: likewise.
	* donrails/app/controllers/login_controller.rb (LoginController::add_article): likewise.
	* donrails/app/views/login/new_article.rhtml: likewise.
	* donrails/app/views/login/manage_article.rhtml: likewise.
	* donrails/app/controllers/atom_controller.rb (AtomController::post): likewise.
	* donrails/app/controllers/atom_controller.rb (AtomController::edit): likewise	
	* donrails/app/controllers/login_controller.rb (LoginController::add_author): likewise
	* donrails/app/views/login/manage_author.rhtml: likewise.
	* donrails/public/stylesheets/araki.css: likewise. Add div.mainarticle div.section.
	* donrails/app/views/shared/authorhead.rhtml: New file. likewise.
	* donrails/app/views/notes/noteslist.rhtm: likewise.
	* donrails/app/views/notes/show_title.rhtml : likewise.

	* UPGRADE_1.1: Add upgrade method for 'blogpings' table

2006-01-20  araki yasuhiro  <yasu@debian.or.jp>

	* donrails/app/views/login/index.rhtml: Fixed typo. Fix: Routing probleem which is reported by Tagoh.
	* donrails/app/views/layouts/login.rhtml: Add link to new_article.
	* donrails/app/controllers/login_controller.rb (LoginController::new_article): New method. Spin off from LoginController::authenticate.
	* donrails/app/views/login/new_article.rhtml: New file.

	* rails/app/views/shared/comment2.rhtml: Fixed typo.

	* rails/test/functional/notes_controller_test.rb
	(NotesControllerTest::test_show_date): New method.
	(NotesControllerTest::test_show_date__2): New method for NotesController::show_date.

	* donrails/app/controllers/notes_controller.rb (NotesController::show_nnen): If invalid time parameter, return 404.

	* rails/test/functional/notes_controller_test.rb (NotesControllerTest::test_show_nnen): New method.

	* donrails/app/controllers/notes_controller.rb (NotesController::show_month): If no article, return 404. If invalid time parameter, return 404.

	* rails/test/functional/notes_controller_test.rb 
	(NotesControllerTest::test_noteslist): New method.
	(NotesControllerTest::test_show_month): New method.
	(NotesControllerTest::test_show_month__{2,3}): New method. (For NotesController::show_month.)

	* donrails/app/models/article_sweeper.rb (ArticleSweeper::expire_for): Fixed: If cache store directories do not exist, cause Errono::ENOENT exception.

	* donrails/app/controllers/notes_controller.rb: 
	- (NotesController::pick_article_a): Change @articles to @article.
	- (NotesController::pick_article_a2): Change @articles to @article.
	- (NotesController::indexabc): More restrict input.
	- (NotesController::dateparse): More restrict input.	
	- (NotesController::parse_nums): More restrict input.		
	* donrails/app/views/notes/catch_ping.rxml: Fix typo.
	* donrails/app/views/notes/pick_article_a2.rhtml: Change @articles to @article.
	* donrails/app/views/notes/pick_article_a.rhtml: Change @articles to @article.	
	* donrails/app/views/notes/comment_form_a.rhtml: Improve case of @article.

2006-01-19  araki yasuhiro  <yasu@debian.or.jp>

	* UNUSE cache for NotesController::{afterday,tendays}
	- donrails/app/models/article_sweeper.rb: likewise.
	- donrails/app/controllers/notes_controller.rb: likewise.
	* donrails/app/controllers/notes_controller.rb: Fixed deal with @articles.empty?
	* donrails/app/controllers/notes_controller.rb: (NotesController::show_title) redirect myself under title or pickid query.
	* donrails/app/views/atom/post.rxml: Fix: no use to link to pick_article.
	* donrails/app/views/notes/rdf_*.rxml: Fix: no use to link to show_title with pickid.
	* donrails/config/routes.rb: Cleanup.

	* ADD test files under donrails/test/.
	* donrails/app/models/article_sweeper.rb: Improve expire_page methods which use @paramas['page'].
	* donrails/config/routes.rb: likewise.
	* donrails/app/controllers/application.rb: Change (ApplicationController::set_charset) does not use under existing Content-Type header priviously.
	* donrails/app/controllers/notes_controller.rb: 
	** Cleaup and merge unuse methods. 
	- (NotesController::show_title2) delete.
	- (NotesController::pick_article) delete.
	-- donrails/app/views/notes/pick_article.rhtml: delte.
	- (NotesController::show_date) remove (NotesController::oneday) alias.
	-- donrails/app/views/layouts/application.rhtml
	-- donrails/app/views/shared/dayselect.rhtml
	** no use paginate
	- (NotesController::show_month)
	- (NotesController::show_date)
	- (NotesController::show_title)
	** add Content-Type: application/xml; charset=utf-8 header
	- (NotesController::rdf_*)
	* donrails/app/views/shared/comment2.rhtml: Cleanup.
	* donrails/app/views/notes/search.rhtml: Cleanup.

2006-01-18  araki yasuhiro  <yasu@debian.or.jp>
	
	* donrails/app/controllers/notes_controller.rb:
	NotesController::show_title can use @prams["pickid"] for backword
	compatibility. (We plan to remove NotesController::pick_article)

	* donrails/app/views/notes/rdf_*.rxml: Change link action from 'pick_article' to 'show_title'.

	* donrails/app/controllers/notes_controller.rb: Fixed Last-Modified: header time format from rfc2822 to rfc2161.
	* donrails/app/controllers/notes_controller.rb: Fixed handling for empty articles. It is important for start-up user.

	* donrails/app/models/article_sweeper.rb: (ArticleSweeper::expire_for) Change in expire_action.

	* routes.rd: Add di.cgi to rdf_recent/feed.xml. Because lighttpd can not parse di.cgi as XML file.

	* donrails/app/controllers/notes_controller.rb: (NotesController::noteslist) disable 304 return. Because 304 feature cause side effect for cache page feature under running webrick. (Under lighttpd, no side effect.) TODO: I hope to integrate these two feature in near future.

	* donrails/app/controllers/application.rb: (ApplicationController) remove after_filter :compress.
	* donrails/app/controllers/atom_controller.rb: (AtomController) add after_filter :compress.
	* donrails/app/controllers/login_controller.rb: (LoginController) add after_filter :compress. 
	* donrails/app/controllers/notes_controller.rb: (NotesController) add after_filter :compress.

	* New Feature: Add page and action cache in NotesController.
	- donrails/app/controllers/notes_controller.rb: Add caches_page and caches_action entries.
	- donrails/config/routes.rb: likewise.
	- donrails/app/models/article_sweeper.rb: (ArticleSweeper) likewise. It is for cleanup cached contents.

	* donrails/app/controllers/notes_controller.rb: 
	- Remove (NotesController::rdf_recent2) for cleanup.
	- Add (NotesController::show_title2).

2006-01-17  Akira TAGOH  <at@gclab.org>

	* donrails/app/views/shared/title-articles.rhtml: fixed a typo.

2006-01-13  araki yasuhiro  <yasu@debian.or.jp>

	* donrails/app/helpers/application_helper.rb: Change (ApplicationHelper::parsecontent) extract databody from <content>databody</conten>.
	* donrails/app/controllers/notes_controller.rb: check nil or empty
	Array for the instance from Article.find say.
	* donrails/app/controllers/notes_controller.rb: Change (NotesController::add_cache_control). Add @maxage parameter. Cache-Control behavior is controlled by @maxage and @lm. 
	
2006-01-13  Akira TAGOH  <at@gclab.org>

	* donrails/app/controllers/notes_controller.rb: check nil or empty
	Array for the instance from Article.find say.

2006-01-12  araki yasuhiro  <yasu@debian.or.jp>

	* donrails/app/helpers/application_helper.rb: New method: ApplicationHelper::parsecontent and ApplicationHelper::bind_article_category, ApplicationHelper::atom_update_article2. These are moved from atom_controller.rb.
	* donrails/app/controllers/atom_controller.rb: likewise.

	* donrails/app/controllers/atom_controller.rb: (AtomController::post) Change 502 return if some troubles.

	* donrails/tool/atomclient/atomcheck.rb: 
	- Add article_date by Time.now.iso8601 unless have article_date. 
	- Use HTree to make up valid HTML.
	* donrails/tool/atomclient/atommail.rb: Code clean.
	* donrails/tool/atomclient/test_atompost.rb: Add stress test in test_atompost__plain.

2006-01-10  araki yasuhiro  <yasu@debian.or.jp>

	* donrails/app/controllers/atom_controller.rb: 
	- Change: (Rechange:) Use compress for atom controller.
	- (AtomController::atom_update_article2): Can accept no <category> and <articledate> in input. 
	- (AtomController::atom_update_article2): Can accept many article format. (Before change, html only).
	* New: to use 'Blogping.active'. If blogping server is 'active'(= 1), send ping. 
	- (AtomController::atom_update_article2): 

	* donrails/tool/atomclient/test_atomcheck.rb: New file.
	* donrails/tool/atomclient/test_atompost.rb: New file.
	* donrails/tool/atomclient/atomcheck.rb: Fix for receive reaction: except status = 201.
	* donrails/tool/atomclient/atomcheck.rb: New class: AtomPost.
	- donrails/tool/atomclient/atompost.rb: likewise.
	* donrails/tool/atomclient/atommail.rb: New file. Early BETA: It is used for e-mail gateway to AtomAPI (post). It is invoked in '~/.forward', and send AtomPOST to some AtomPOST uri.

2006-01-10  Akira TAGOH  <at@gclab.org>

	* donrails/app/views/login/manage_comment.rhtml: fixed a typo.

	* donrails/app/controllers/notes_controller.rb (NotesController::pick_article):
	parse the title and strip the html tags down then.
	(NotesController::noteslist): likewise.
	(NotesController::show_date): likewise.
	(NotesController::show_title): likewise.
	(NotesController::afterday): likewise.
	(NotesController::tendays): likewise.

2006-01-06  araki yasuhiro  <yasu@debian.or.jp>

	* donrails/app/controllers/application.rb: Fix for client which does not send Accept-Encoding header.

	* blogpings TABLE added new column 'active'.
	- UPGRADE_1.1: New file. This file is upgrade guide from 1.0 to 1.1.
	- donrails/app/controllers/login_controller.rb: add active/deactive method.(delete_blogping)
	- donrails/app/views/login/manage_blogping.rhtml: Same above.

	* donrails/tool/atomclient/atompost.rb: Add some notice in --help.
	* donrails/app/controllers/atom_controller.rb: Change: Do not use compress for atom controller action exclude 'feed'.
	
2006-01-05  araki yasuhiro  <yasu@debian.or.jp>

	* donrails/app/controllers/application.rb: New Feature: Output gzip compression. It derived from http://blog.craz8.com/articles/2005/12/07/rails-output-compression.

	* donrails/app/controllers/notes_controller.rb: Fix: @lm was located before Article.find in 'recent'.

	* New Feature: Add cache control headers.(rfc2616 14.9) 
	- 'Last-Modified: ' time was generated from Article.article_mtime.
	- Add 'Cache-Control: public'. 
	- donrails/app/controllers/notes_controller.rb: New method 'add_cache_control' as after_filter.
	* Experimental Feature: Return '304 Not Modified' if @request.env["HTTP_IF_MODIFIED_SINCE"] is later than Last-Modified date. (notes/noteslist only.)
	
2006-01-04  araki yasuhiro  <yasu@debian.or.jp>

	* donrails/app/controllers/notes_controller.rb: Fix @recent_comments in 'recent' method.

2005-12-29  araki yasuhiro  <yasu@debian.or.jp>

	* donrails/app/controllers/notes_controller.rb: Method 'index' was changed to call 'recent' method.
	* donrails/app/views/shared/category_title_list.rhtml: Add to show 'Please wait reading.. or link' for non JavaScript enabled browser.

	* donrails/app/controllers/notes_controller.rb: New method 'comment_form_a'.
	* donrails/app/views/shared/comment2.rhtml: Change to call /notes/comment_form_a/id.
	* donrails/app/views/notes/noteslist.rhtml: Change to use from shared/comment to shared/comment2.
	* donrails/public/stylesheets/araki.css: Some change.

2005-12-28  araki yasuhiro  <yasu@debian.or.jp>

	* donrails/app/views/shared/comment-form.rhtml: New file.
	* donrails/app/views/shared/comment.rhtml: Move lines to comment-form.rhtml.
	* donrails/app/views/shared/comment2.rhtml: New file (now writting.)
	* donrails/app/views/notes/pick_article_a2.rhtml: Change to call from comment-noadd to comment2.
	* donrails/app/views/notes/pick_article_a.rhtml: Remove unused lines.
	* donrails/public/stylesheets/araki.css: add some entry.

2005-12-27  araki yasuhiro  <yasu@debian.or.jp>

	* donrails/app/controllers/notes_controller.rb: 
	- New method 'pick_article_a2'.
	- New method 'show_search_noteslist'.	
	- New method 'recent_trigger_title_a'.		
	- Remove useless 'recent' in many methods.
	* donrails/app/views/shared/category_title_list.rhtml: Add div.ctl.
	* donrails/app/views/shared/show_direct.rhtml: New file.
	* donrails/app/views/shared/category_select.rhtml: New div.category_select.
	* donrails/app/views/notes/show_category2.rhtml: Remove file.
	* donrails/app/views/notes/recent_trigger_title_a.rhtml: Some fix.
	* donrails/app/views/notes/search.rhtml: Change to escape for displaying @params['h']
	* donrails/app/views/notes/pick_article_a2.rhtml: New file.
	* donrails/app/views/notes/show_category.rhtml: Some change.
	* donrails/public/stylesheets/araki.css: Add div.sidebar div.{ctl,show_direct,category_select}

2005-12-26  araki yasuhiro  <yasu@debian.or.jp>

	* donrails/app/views/notes/recent_category_a.rhtml: New file.
	* donrails/app/views/notes/recent_category_title_a.rhtml: New file.
	* donrails/tool/atomclient/atompost.rb: atompost.rb add to send escaped <content>blah,blah,blah</content>.

2005-12-25  araki yasuhiro  <yasu@debian.or.jp>

	* donrails/app/views/login/manage_{comment,article,trackback}.rhtml: Chage to remove useless space.

	* Patch apply from branche/1.0 (109)
	- donrails/app/controllers/atom_controller.rb: New private method: parsecontent.
	- donrails/tool/atomclient/{atompost,hnfhelper}.rb:
	-- New '--preescape' option. atompost.rb does not HTML escape in <pre></pre> text.
	-- Some change to apply http://www.ietf.org/internet-drafts/draft-ietf-atompub-protocol-06.txt.
	- README_1.0: New file.
	- Makefile: Change for dist release 1.0.

2005-12-21  araki yasuhiro  <yasu@debian.or.jp>

	* Road to 1.1 start.

	* donrails/app/controllers/notes_controller.rb: 
	- New methods. recent_category_title_a and category_select_a. 
	- Change in recent method. Remove @recent_*_articles (* is category name) and @categories. (Use shared/{category_title_list,category_select}.rhtml for alternative)
	- Add @recent_trackbacks. 
	- Change recent_category method to private method.
	* donrails/app/views/shared/search.rhtml: New file.
	* donrails/app/views/shared/category_title_list.rhtml: New file.
	* donrails/app/views/shared/category_select.rhtml: New file.
	* donrails/app/views/notes/category_select_a.rhtml: New file.
	* donrails/example/notes.rhtml: Change to call these new Ajax method.
	
2005-12-21  Akira TAGOH  <at@gclab.org>

	* donrails/lib/modules/wiliki.rb (DonRails::Wiliki::body_to_html): 
	added $$img support.

2005-12-20  araki yasuhiro  <yasu@debian.or.jp>

	* 0.99.2
	* donrails/app/helpers/login_helper.rb: New file.
	* donrails/app/controllers/login_controller.rb: Fix delete_trackback. Not worked!

	* donrails/app/controllers/atom_controller.rb: 
	- New method atom_update_article2. 
	- Rmove atom_update_article and atom_input_parse.
	- Apply for RFC4287.
	* donrails/tool/atomclient/atompost.rb: Apply for RFC4287(atomCategory).

2005-12-14  araki yasuhiro  <yasu@debian.or.jp>

	* donrails/app/controllers/atom_controller.rb: FIX format of Atom POSTed article.(Change plain to html).
	* donrails/app/views/notes/noteslist.rhtml: FIX to hide non categorized article's category name.
	* donrails/app/views/login/manage_article.rhtml: Change to show format name of article.
	* donrails/app/views/login/form_article.rhtml: Change to be enable to change format name of article.

2005-12-12  araki yasuhiro  <yasu@debian.or.jp>

	* Fix: HNF format '~' behavior. 
	- donrails/lib/modules/hnf.rb
	- donrails/tool/atomclient/hnfhelper.rb
	* donrails/tool/atomclient/atomcheck.rb: Fix no check mode. Under more than 2 articles in one HNF file, after 2nd articles are checked.
	* donrails/tool/atomclient/atompost.rb: 
	- New method 'usage'. It displays help message.
	- Fix no check mode. Under more than 2 articles in one HNF file, after 2nd articles are checked. Run 'atompost.rb --help' to access.


2005-12-11  araki yasuhiro  <yasu@debian.or.jp>

	* Fix: Warning message "don't put space before argument parentheses".
	- notes/{show_category,show_title,noteslist,pick_article,pick_article_a}.rhtml

2005-12-10  araki yasuhiro  <yasu@debian.or.jp>

	* donrails/app/models/ping.rb: Clean no need include line.
	* donrails/app/models/article.rb: Clean relation to pings and trackbacks.
	* donrails/app/controllers/atom_controller.rb: Add article.save. (Almost case work well without this change.)
	* donrails/app/views/login/manage_comment.rhtml: Fix under comment.artiocles.first is not exist.
	* donrails/app/views/login/manage_article.rhtml: Fix under artiocle is not exist.
	* donrails/app/views/login/manage_trackback.rhtml: Fix typo.
	* donrails/app/views/login/manage_ping.rhtml: Fix for display article id.
	* donrails/tool/atomclient/atompost.rb: Fix for lack argument.
	
2005-12-09  araki yasuhiro  <yasu@debian.or.jp>

	* donrails/app/controllers/atom_controller.rb:
	* donrails/app/helpers/application_helper.rb
	- Fix atompost. After SVN revision 91, atompost was broken. Som atom post related methods are moved from application_helper.rb to atom_controller.rb.
	* donrails/app/models/ping.rb: Change in send_pings2 method. Set timeout 10 seconds.
	* donrails/app/models/article.rb: Fix in send_pings2 method.
	* donrails/app/controllers/notes_controller.rb: New method 'catch_ping'. Mainly use for Ping.send_pings2 test.
	* donrails/app/views/notes/catch_ping.rxml: New file.
	* donrails/tool/atomclient/atompost.rb: Add new '--nocheck' argument. It used to skip duplicate Atom POST. (mainly for testing.)
	* donrails/public/stylesheets/araki.css: Add 'cite' related configuration.

2005-12-08  araki yasuhiro  <yasu@debian.or.jp>

	* donrails/tool/tables-sqlite.txt: Fix table schema for blogpings.
	* donrails/app/controllers/login_controller.rb: New method 'add_blogping'.
	* donrails/app/views/shared/timelink.rhtml: (I lacked to add these file in SVN)
	* donrails/app/models/{blogping,trackback}.rb: (I lacked to add these file in SVN)
	* INSTALL.ja: Add library information.
	* donrails/app/controllers/notes_controller.rb: Change trackback behavior. Trackback accepts HTTP POST only.
	* donrails/app/views/layouts/login.rhtml: Add link to /login/index.
	* donrails/app/views/shared/comment.rhtml: Add to show trackback entities.
	* donrails/app/views/notes/noteslist.rhtml: Add link to show_category.
	* donrails/public/stylesheets/araki.css: Add trackback related configuration.

2005-12-08  Akira TAGOH  <at@gclab.org>

	* donrails/tool/tables-postgresql.txt: use timestamp instead of
	datetime. it was obsolete since 7.3.

2005-12-05  araki yasuhiro  <yasu@debian.or.jp>

	* **** INPORTANT **** NEW tables ****
	* donrails/tool/tables-sqlite.txt: New tables: blogpings, pings and trackbacks.

	* donrails/app/views/notes/pick_article_a.rhtml: No write article.body_to_html if article.body does not exist.

	* donrails/app/views/notes/trackback.rxml: New file

	* donrails/app/views/login/manage_{trackback, ping, blogping}.rhtml: New file. 

	* donrails/app/views/shared/comment-noadd.rhtml: add to show article.trackbacks.

	* donrails/app/views/layouts/login.rhtml: Add link to manage_{trackback, blogping, ping}.

	* donrails/app/controllers/notes_controller.rb: New method: tackback

	* donrails/app/controllers/login_controller.rb: New methods: manage_trackback, delete_trackback, manage_ping, manage_blogping, delete_blogping, manage_author.

	* donrails/app/models/article.rb: Describe relationship with 'pings' table. New method 'send_ping2'.

	* donrails/app/models/ping.rb: New file. Pings table records ping from donrails to othre ping receivable service.

	* donrails/app/helpers/application_helper.rb: New methods 'atom_input_parse', 'atom_update_article', 'bind_article_category', 'article_url' and 'sendping'.

	* donrails/app/helpers/atom_helper.rb: New file.

	* donrails/app/controllers/atom_controller.rb: Many methods removed to atom_helper.rb.

2005-11-26  araki yasuhiro  <yasu@debian.or.jp>

	* donrails/app/controllers/atom_controller.rb: Change to extract title from <title><blah></blah></title>. Former version can not extract title which is not plain text.

2005-11-25  araki yasuhiro  <yasu@debian.or.jp>

	* donrails/config/routes.rb: 'notes/search/:q' is new method to access search.

	* New action 'rdf_search'.
	- donrails/app/controllers/notes_controller.rb: add rdf_search. Redirect rdf_search if no category is inputted in rdf_category.

	* donrails/lib/modules/hnf.rb: Change output for 'body_to_xml'. If HTree.parse(self.body_to_html).to_rexml is failed, return self.body_to_html.

	* donrails/app/views/notes/rdf_category.rxml: Change link from rdf_category to show_category_noteslist.

	* donrails/app/views/notes/rdf_article.rxml: Change link from rdf_article to show_title.

	* donrails/app/controllers/notes_controller.rb: Change rdf_category. If inputted category does not exist, redirect to rdf_recent.

	* Remove link ':title' parameter from to :action=>'show_title'. 
	Because it cause confuse of link uri. (notes/t/:title and notes/show_title/:id:title). 
	Now all donrails files make link by 'notes/id/:id'.
	But you also use both 'notes/t/:title' and 'notes/id/:id'.
	- donrails/app/views/shared/linktitle.rhtml
	- donrails/app/views/shared/title-articles2no.rhtml
	- donrails/app/views/shared/title-articles2.rhtml
	- donrails/app/views/notes/show_category.rhtml
	- donrails/app/views/notes/show_category2.rhtml
	- donrails/app/views/notes/show_title.rhtml
	- donrails/app/views/notes/noteslist.rhtml
	- donrails/app/views/notes/pick_article.rhtml
	- donrails/config/routes.rb

2005-11-24  araki yasuhiro  <yasu@debian.or.jp>

	* donrails/app/views/notes/rdf_{article,category,recent}.rxml: add article body in <content:encoded><![CDATA[blah blah blah]]></content:encoded>.

2005-11-23  araki yasuhiro  <yasu@debian.or.jp>

	* donrails/tool/atomclient/hnfhelper.rb: Some fix for HNF to html. 

	* donrails/lib/modules/hnf.rb:
	- Now use HTree in body_to_xml.
	- Some fix for HNF to html.

	* donrails/lib/modules/html.rb: Now use HTree in body_to_xml.

	* donrails/app/views/notes/rdf_category.rxml: Change to no excape <>&. in <description> </description>.

	* donrails/app/views/notes/rdf_recent.rxml: Change to no excape <>&. in <description> </description>.

	* NEW action 'notes/rdf_article':
	- donrails/app/controllers/notes_controller.rb: New method rdf_article.
	- donrails/app/views/notes/rdf_article.rxml: New file.

	* donrails/app/controllers/application.rb: Change set_charset to off.

2005-11-19  araki yasuhiro  <yasu@debian.or.jp>

	* donrails/public/stylesheets/araki.css: Change in div.section.

	* donrails/app/controllers/application.rb: New method: set_charset. It used for set the charset and Content-type.

2005-11-18  araki yasuhiro  <yasu@debian.or.jp>

	* donrails/lib/modules/html.rb: Change in body_to_xml. It use htree for convert html to xml.

	* donrails/app/views/notes/rdf_category.rxml: If xml.description is failed, print error log.

2005-11-17  araki yasuhiro  <yasu@debian.or.jp>

	* donrails/tool/atomclient/atomcheck.rb: Fix in check().

 	* donrails/app/views/notes/rdf_category.rxml: New file. It is used for making categorized rdf.

	* donrails/app/views/notes/rdf_recent.rxml: Some change.

	* donrails/app/views/notes/noteslist.rhtml: Add link to show_category

	* donrails/app/views/notes/show_category.rhtml: Add link to show_category_noteslist

	* donrails/app/controllers/notes_controller.rb: Change: rdf_category shows only 20 articles. 

2005-11-16  araki yasuhiro  <yasu@debian.or.jp>

	* atompost:
	- New file donrails/tool/atomclient/hnfhelper.rb.
	- New file donrails/tool/atomclient/atomcheck.rb.
	- donrails/tool/atomclient/atompost.rb: 
	-- Split HNF related codes.
	-- New feature: It can post HTML file.
	-- New feature: Posted information is memorized in DB. (config file is ENV['HOME']}/.donrails/atompost.yaml)
	-- It needs 'rexml/document', 'htree' and 'time' module.

	* donrails/app/controllers/notes_controller.rb: New method. 'rdf_category' and 'show_category_noteslist'.

	* donrails/config/routes.rb: 
	- "notes/d/:category" is routed to 'show_category_noteslist'.
	- "notes/rdf_category/:category" is routed to 'rdf_category'.
	

	* donrails/app/controllers/atom_controller.rb: Change: At AtomAPI post, invalid input will reject. 

	* donrails/app/helpers/application_helper.rb: 'don_mb_truncate': Change to remove html tag. It is used for article administration.

2005-11-08  araki yasuhiro  <yasu@debian.or.jp>

	* donrails/tool/hnf2db.rb: Some fix.

	* donrails/tool/atomclient/atompost.rb: Support HNF type original file format.

	* donrails/lib/modules/html.rb: New method. Support HTML body.

	* donrails/app/controllers/atom_controller.rb: 
	- AtomAPI support <title/>, <article_date/> and <category/>.
	- If AtomAPI post failed, return 404.
	

2005-11-01  Akira TAGOH  <at@gclab.org>

	* donrails/lib/modules/wiliki.rb (DonRails::Wiliki::title_to_xml):
	added a missing method for XML.
	(DonRails::Wiliki::body_to_xml): likewise.

2005-10-16  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/controllers/atom_controller.rb: Change for logging AtomAPI post.

	* donrails/tool/atomclient/wsse.rb: New file.

	* donrails/tool/atomclient/atompost.rb: New file. 

	* donrails/tool/tables-sqlite.txt: Fix: SQL syntax.

2005-10-14  Akira TAGOH  <at@gclab.org>

	* donrails/lib/modules/wiliki.rb (DonRails::Wiliki::title_to_html):
	don't include a space into the front strings matched.

2005-10-10  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/views/atom/index.rxml: Change for adding recent articles in /atom/.

	* donrails/app/views/atom/feed.rxml: Change for adding recent articles in /atom/feed.

	* donrails/app/controllers/atom_controller.rb: Change for no auth at /atom/feed. Change for adding recent articles in /atom/ and /atom/feed.

	* donrails/app/controllers/application.rb: Fix for WSSE auth.

2005-10-07  Akira TAGOH  <at@gclab.org>

	* donrails/app/views/shared/title-articles.rhtml: use don_mb_truncate
	instead of truncate.
	* donrails/app/views/login/manage_comment.rhtml: likewise.
	* donrails/app/views/login/manage_article.rhtml: likewise.
	* donrails/app/views/notes/show_category.rhtml: likewise.

	* donrails/app/helpers/application_helper.rb (ApplicationHelper::don_mb_truncate):
	similar method to truncate, but multibytes support.

2005-10-04  Akira TAGOH  <at@gclab.org>

	* donrails/lib/modules/wiliki.rb (DonRails::Wiliki::body_to_html):
	fixed the behavior to work similar to wiliki.

2005-10-01  araki yasuhiro  <yasu@debian.or.jp>

	* donrails/lib/antispam.rb: Modify to apply 'ipaddr' and 'hostname' in Blacklist.format.

	* donrails/app/views/login/manage_blacklist.rhtml: New file.

	* donrails/app/views/layouts/login.rhtml: Add link to manage_blacklist.

	* donrails/app/views/shared/comment.rhtml: Remove unused comment line.

2005-10-01  Akira TAGOH  <at@gclab.org>

	* donrails/lib/donplugin.rb (DonRails::Plugin): New class.

	* donrails/tool/plugin-setup.rb (Installer::uninstall):
	removed the unnecessary debug code.
	(TableInstaller::initialize): prefer the absolute path.

	* donrails/plugins/calendar/calendar.rhtml: removed style tag to be
	XHTML compliant.

	* donrails/app/helpers/application_helper.rb (ApplicationHelper::don_get_stylesheets):
	New method to get the list of stylesheets required.

2005-09-30  Akira TAGOH  <at@gclab.org>

	* donrails/app/views/shared/comment.rhtml: Use maxlength instead of
	maxsize.

	* donrails/lib/modules/wiliki.rb (DonRails::Wiliki::body_to_html):
	Modified to be XHTML compliant.
	(DonRails::Wiliki::output_list): likewise.

2005-09-28  Akira TAGOH  <at@gclab.org>

	* donrails/lib/modules/hnf.rb (DonRails::HNF::body_to_html):
	Modified to be XHTML compliant.

	* donrails/lib/modules/wiliki.rb (DonRails::Wiliki::body_to_html):
	Use <br/> instead of <br> to be XHTML compliant.

2005-09-27  araki yasuhiro  <yasu@debian.or.jp>

	* donrails/app/views/login/manage_comment.rhtml: Change id='ca' to 'comment_ajax'.

	* donrails/app/views/shared/comment.rhtml: Change 'id' for unique. 

2005-09-26  araki yasuhiro  <yasu@debian.or.jp>

	* donrails/app/controllers/login_controller.rb: Fix orphaned comments problem. 

	* donrails/donrails/app/controllers/atom_controller.rb: Fix AtomAPI delete success return code 200 to 204. (According to draft-ietf-atompub-protocol-04.txt.)

2005-09-25  Akira TAGOH  <at@gclab.org>

	* donrails/tool/plugin-setup.rb: Added new program to assist the plugin
	installation/removal.

	* donrails/tool/tables-sqlite.txt: Added plugins table.
	* donrails/tool/tables-postgresql.txt: likewise.

	* donrails/plugins/calendar: New plugin for calendar.
	* donrails/lib/calendar.rb: likewise.
	* donrails/public/stylesheets/calendar.css: likewise.

	* donrails/app/views/shared/calendar.rhtml: moved onto plugins directory.
	* donrails/app/views/shared/comment.rhtml: removed the unnecessary </p> tag.

	* donrails/app/models/plugin.rb: New model class.

2005-09-09  Akira TAGOH  <at@gclab.org>

	* donrails/public/stylesheets/calendar.css: New file.

	* donrails/app/views/shared/calendar.rhtml: New file.

	* donrails/lib/calendar.rb: New file to generate the calendar.

2005-09-09  araki yasuhiro  <yasu@debian.or.jp>

	* donrails/app/models/author.rb: Validates presence.

	* donrails/app/models/blacklist.rb: Validates presence.

2005-09-08  araki yasuhiro  <yasu@debian.or.jp>

	* donrails/tool/tables-postgresql.txt: Add new 'blacklists' table.

	* donrails/tool/tables-sqlite.txt: Add new 'blacklists' table.

	* donrails/lib/antispam.rb: Change for using 'blacklists' table.

	* donrails/app/controllers/login_controller.rb: New method: {manage|delete|add}_blacklist.

	* donrails/app/models/blacklist.rb: New file.

	* donrails/app/models/blacklist_pattern.rb: Delete file.

2005-09-08  Akira TAGOH  <at@gclab.org>

	* donrails/app/views/login/authenticate.rhtml: choose the preferred
	format by default.

	* donrails/app/controllers/login_controller.rb (LoginController::authenticate):
	determine which format is mostly used.

	* donrails/lib/modules/wiliki.rb (DonRails::Wiliki::title_to_html):
	New method.

	* donrails/lib/modules/hnf.rb (DonRails::HNF::body_to_html): split
	the strings up against CRLF or CR or LF.

	* donrails/lib/modules/wiliki.rb: New input format parser module to
	support WiLiKi format.
	(DonRails::Wiliki::body_to_html): split the strings up against CRLF or CR or LF.
	(DonRails::Wiliki::output_block): escape the strings when it's in pre tag.

2005-09-07  araki yasuhiro  <yasu@debian.or.jp>

	* donrails/lib/modules/hnf.rb: Fix for luck of LF in PRE /PRE commands.

	* donrails/lib/antispam.rb: Fix for call subroutine.
	
2005-09-06  Akira TAGOH  <at@gclab.org>

	* donrails/lib/modules/rd.rb: trivial fix.

2005-09-05  araki yasuhiro  <yasu@debian.or.jp>

	* donrails/lib/modules/hnf.rb: Fix for does not process line which is started with "~".

2005-09-04  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/app/views/atom/index.rxml: Add link to service.feed and service.categories.

	* donrails/app/views/atom/categories.rxml: New file.

	* donrails/app/views/atom/feed.rxml: New file.

	* donrails/app/controllers/atom_controller.rb:
	- Change wsse_auth debug ip address. Localhost client pass without wsse.
	- New method feed().
	- New method categories().

2005-09-04  Akira TAGOH  <at@gclab.org>

	* donrails/app/controllers/notes_controller.rb (NotesController::noteslist):
	Added an exception.

2005-09-03  araki yasuhiro  <yasu@debian.or.jp>

	* donrails/app/views/login/manage_author.rhtml: Change description in english to japanese.

	* donrails/app/views/layouts/login.rhtml: Add link for ':action => "logout"'.

2005-09-02  araki yasuhiro  <yasu@debian.or.jp>

	* donrails/app/models/author.rb: Fix filename.(wrong file name: authors.rb)

	* donrails/app/views/notes/show_title.rhtml: (Partially) Fix for don_get_object.

	* INSTALL.ja: Donrails now depends on RD library.

        * donrails/tools/table-{sqlite,postgresql}.txt: Add Author.writable

        * donrails/app/controller/login_controller.rb: Change for manage_author.rhtml

        * donrails/app/views/login/manage_author.rhtml: New view for management
AtomAPI authors.

2005-09-01  Akira TAGOH  <at@gclab.org>

	* donrails/lib/delegator.rb (DonRails::DataFormatDelegator): undef id
	to pass it to the original object.
	(DonRails::DataFormatDelegator::formatmap): store the modules list
	into $formatmap and ensure to do Dir.glob just one time.

2005-08-31  Akira TAGOH  <at@gclab.org>

	* donrails/app/helpers/application_helper.rb (ApplicationHelper::don_get_object):
	New method to get DataFormatDelegator object for the article.
	(ApplicationHelper::don_to_title): removed.
	(ApplicationHelper::don_to_html): removed.

	* donrails/lib/modules/rd.rb (DonRails::RD::title_to_html): renamed from title.
	(DonRails::RD::body_to_html): renamed from to_html.
	(DonRails::RD::title_to_xml): New method.
	(DonRails::RD::body_to_xml): New method.

	* donrails/lib/modules/hnf.rb (DonRails::HNF::title_to_html): renamed from title.
	(DonRails::HNF::body_to_html): renamed from to_html.
	(DonRails::HNF::title_to_xml): New method.
	(DonRails::HNF::body_to_xml): New method.

	* donrails/lib/delegator.rb (DonRails::DataFormatDelegator::initialize): API changes.
	(DonRails::DataFormatDelegator::method_missing): extend String and call
	the method here when the method name '<fieldname>_to_<type>' is given.
	(DonRails::PlainText::title_to_html): renamed from title
	(DonRails::PlainText::body_to_html): renamed from to_html
	(DonRails::PlainText::chomp_tags): moved to ApplicationHelper#don_chomp_tags
	(DonRails::PlainText::title_to_xml): New method.
	(DonRails::PlainText::body_to_xml): New method.

	* donrails/app/views/shared/linktitle.rhtml: applied the above changes.
	* donrails/app/views/shared/title-articles2no.rhtml: likewise.
	* donrails/app/views/shared/title-articles2.rhtml: likewise.
	* donrails/app/views/shared/title-articles.rhtml: likewise.
	* donrails/app/views/shared/random-article.rhtml: likewise.
	* donrails/app/views/notes/show_category.rhtml: likewise.
	* donrails/app/views/notes/show_category2.rhtml: likewise.
	* donrails/app/views/notes/show_title.rhtml: likewise.
	* donrails/app/views/notes/noteslist.rhtml: likewise.
	* donrails/app/views/notes/search.rhtml: likewise.
	* donrails/app/views/notes/pick_article.rhtml: likewise.
	* donrails/app/views/notes/pick_article_a.rhtml: likewise.
	* donrails/app/views/notes/rdf_recent.rxml: likewise.

2005-08-28  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* donrails/lib/modules/hnf.rb: Fix for not processing HNF command line which begin with "/".

	* donrails/app/views/login/authenticate.rhtml: Little change <hr><hr> to <hr>.

	* donrails/app/views/layouts/login.rhtml: Add link to manage_author(), delete_author()

	* donrails/app/controllers/login_controller.rb: New manage_author(), delete_author() for atom author management.

2005-08-27  araki yasuhiro  <yasu@debian.or.jp>

	* donrails/lib/modules/hnf.rb: Fix for not displaying body.

	* donrails/app/views/login/authenticate.rhtml: Remove links to manage_article/manage_comment/hnf_save_all. Because these links now in layouts/login.rhtml

	* donrails/app/views/layouts/login.rhtml: Change for easy navigation.

	* donrails/app/controllers/login_controller.rb: NEW logout().

	* donrails/app/controllers/application.rb: WSSE authentification function change. Now use user/pass pair is sotred in Authors.

2005-08-26  Akira TAGOH  <at@gclab.org>

	* donrails/lib/modules/hnf.rb (DonRails::HNF::to_html): fixed a typo.

	* donrails/app/views/shared/linktitle.rhtml: modified to fit to the latest application helper.
	* donrails/app/views/shared/title-articles2no.rhtml: likewise.
	* donrails/app/views/shared/title-articles2.rhtml: likewise.
	* donrails/app/views/shared/title-articles.rhtml: likewise.
	* donrails/app/views/shared/rundom-article.rhtml: likewise.

	* donrails/app/views/notes/show_category.rhtml: modified to fit to the latest application helper.
	* donrails/app/views/notes/show_category2.rhtml: likewise.
	* donrails/app/views/notes/show_title.rhtml: likewise.
	* donrails/app/views/notes/search.rhtml: likewise.
	* donrails/app/views/notes/pick_article.rhtml: likewise.

	* donrails/app/helpers/application_helper.rb (ApplicationHelper::don_chomp_tags):
	  New method.

	* donrails/app/helpers/hnf_helper.rb: REMOVED.

	* donrails/lib/delegator.rb (DonRails::PlainText::title): New method.
	(DonRails::DataFormatDelegator::formatmap): hack to find the input format modules all.

	* donrails/lib/modules/hnf.rb (DonRails::HNF::title): New method.

	* donrails/lib/modules/rd.rb (DonRails::RD::title): New method.
	(DonRails::RD::to_html): ensure "\n" at the end of the given string.

	* donrails/app/views/notes/noteslist.rhtml: modified against the application_helper.rb's change.

	* donrails/app/views/notes/pick_article_a.rhtml: likewise.

	* donrails/app/views/login/authenticate.rhtml: show the supported input format from
	  don_supported_formats instead of hardcoded stuff.

	* donrails/app/helpers/application_helper.rb (ApplicationHelper::don_supported_formats):
	  New method to get which input format DonRails supported.
	(ApplicationHelper::don_to_title): New method to convert String to the article title.
	(ApplicationHelper::don_to_html): New method to convert String to HTML.
	(ApplicationHelper::remove_html_gl, don_lnew, don_link, plain_remove_html_gl):
	(ApplicationHelper::plain_don_link, plain_don_line_link, plain_don_line_2kaigyo):
	(ApplicationHelper::plain_don_lnew): REMOVED.

2005-08-26  araki yasuhiro  <yasu@debian.or.jp>

	* donrails/app/models/authors.rb: New models. It store user/pass entry for AtomAPI post/edit/delete.

	* donrails/app/controllers/application.rb: Change wsse_match(user,pass,wsse) to wsse_match(wsse). wsse_match(wsse) search user and pass from Authors.
	* donrails/tool/tables-sqlite.txt: Add authors table.
	* donrails/tool/tables-postgresql.txt: Add authors table.
	* donrails/tool/tables.txt: REMOVE.

	* donrails/app/helpers/application_helper.rb: Fix pub_date time format. Now use Time.iso8601.

	* donrails/app/controllers/application.rb: Fix regexp error.

	* donrails/app/helpers/application_helper.rb: Add don_lnew() and plain_don_lnew(). These are removed from hnf_helper.rb.

	* INSTALL.ja: Add information for setup.

	* donrails/app/views/atom/{index|post}.rxml: New AtomAPI template.

	* donrails/app/controllers/atom_controller.rb: New controler. AtomAPI controller.

2005-08-26  Akira TAGOH  <at@gclab.org>

	* donrails/lib/modules/rd.rb: New module. RD parser.

	* donrails/lib/modules/hnf.rb: New module. hnf parser.

	* donrails/lib/delegator.rb: New class to delegate the object to each output format module.

2005-08-25  Akira TAGOH  <at@gclab.org>

	* donrails/app/views/login/authenticate.rhtml: fixed a typo. plainf should be plain.

	* donrails/app/helpers/application_helper.rb (ApplicationHelper::plain_don_line_2kaigyo): fixed a typo.

	* donrails/tool/tables-postgresql.txt: New file for PostgreSQL.

	* donrails/app/controllers/login_controller.rb (LoginController::delete_article): prevent NoMethodError for nil.

2005-08-25  araki yasuhiro  <yasu@debian.or.jp>

	* Add: """map.connect '', :controller => "notes", :action => "index" """ in routes.rb. 

2005-08-25  Akira TAGOH  <at@gclab.org>

	* donrails/app/controllers/notes_controller.rb (NotesController::recent_category): returns the empty Array when there is no categories.

2005-08-24  araki yasuhiro  <yasu@debian.or.jp>

	* New: apply for "plain" article format.

	* Change: at no articles, return 404.

	* Split application_helper.rb's HNF related lines to "hnf_helper.rb".

	* Add: Makefile: "make init" make link to donrails/lib to use antispam.rb.

	* Fix: INSTALL.ja: config files are located under rails/config. (wrong: donrails/config) (thanks tagoh)

2005-08-23  araki yasuhiro  <yasu@debian.or.jp>

	* Change: donrails-setup.rb: Now some values set dafault.(thanks tagoh)

2005-08-22  araki yasuhiro  <yasu@debian.or.jp>

	* Add: In map.connect "notes/every_year/:month/:day" to display the same day of the year.

2005-08-21  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* New: wsse_generate and wsse_match. These will be used for AtomAPI.

2005-08-20  ARAKI Yasuhiro  <yasu@debian.or.jp>

	* Change: Paginate for notes/afterday is broken. Now notes/afterday is not paginated. Simply show 30 articles.

	* New: "@noindex" class parameter to control add '''<meta name="robots" content="noindex">''' tag in header. (Please show notes.rhtml)

	* Change: notes_controller.rb: 'dateparse' method is now protected.

2005-08-19  araki yasuhiro  <yasu@debian.or.jp>

	* Change: Makefile and donrails-setup.rb: "rails -d rails" is maybe debian extension. I change "rails rails" to setup by 'make' command. (thanks: tagoh)
	* Fix: At artilce format is HNF, "<img src=... >" is not rendered.

	* Add: can show cross year same day articles. For example, "notes/?0101" show Jun.1 day's articles. Now it limits 10 years.

2005-08-18  araki yasuhiro  <yasu@debian.or.jp>

	* Fix: add_comment2: Can not post comment under /note/titile/hogehoge...
	* Change rdf_recent.rxml title format. If title includes URL scheme, not it is stripped.
	
2005-08-17  araki yasuhiro  <yasu@debian.or.jp>

	* Fix: some user defined tags (TENKI, TAION..) are displayed. 

2005-08-16  araki yasuhiro  <yasu@debian.or.jp>

	* Add: show_title search trigger by 'id'. If 'id' is lacked, use 'title'.
	* Change rdf_recent.rxml date format from Article.ariticle_date to Article.article_mdate.
	
2005-08-15  araki yasuhiro  <yasu@debian.or.jp>

	* Fix: hnf2db.rb could not use rail/lib/antispam.rb. Fixed.
	* If "yyyymm(a|b|c)", show the (first|2nd|3rd) ten days of a month.

2005-08-14  araki yasuhiro  <yasu@debian.or.jp>

	* add function for comment spam. Many functions derived from "typo".

2005-08-12  araki yasuhiro  <yasu@debian.or.jp>

	* Add @recent_comment parameters to display recent articles with comments.

2005-08-10  araki yasuhiro  <yasu@debian.or.jp>

	* At displaying search results, seach keyword is highlighted.
	* At displaying search results, seach text is excerpted.

	* Comment validation methods are changed. Now it works in model/comment.rb
	* In Comment.body, If you want to write HTML format, you can use restricted tags. (Current: allow = ['p','br','i','b','u','ul','li'])

2005-08-08  araki yasuhiro  <yasu@debian.or.jp>

	* Fix: Backup all articles in "hnf" file format is not working.

2005-08-07  araki yasuhiro  <yasu@debian.or.jp>

	* Fix: the function (show_date in notes_controler.rb) does not run well.
	* Add: "view/layout/login.rhtml". All under "login" use login.rhtml as layout.
	* Add: "login/form_article". For fixing article title and body.
	
2005-08-06  araki yasuhiro  <yasu@debian.or.jp>

	* convert all euc-jp files to utf-8.
	* prepare import to "svn://svn.berlios.de/donrails/trunk" or "svn+ssh://developername@svn.berlios.de/svnroot/repos/donrails/trunk"
	* hnf2db.rb: Fix dialogue.

